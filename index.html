<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sai Soft Infosys - Intern Portal</title>
  <script src="https://cdn.tailwindcss.com"></script><!-- Firebase SDKs - Using compat version for easier integration -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;family=Poppins:wght@600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    body.dark-mode {
      background: #0f172a;
      color: #e2e8f0;
    }
    
    .dark-mode .bg-white {
      background: #1e293b !important;
      color: #e2e8f0 !important;
    }
    
    .dark-mode .bg-slate-50 {
      background: #0f172a !important;
    }
    
    .dark-mode .bg-slate-100 {
      background: #334155 !important;
    }
    
    .dark-mode .text-slate-800 {
      color: #e2e8f0 !important;
    }
    
    .dark-mode .text-slate-600 {
      color: #cbd5e1 !important;
    }
    
    .dark-mode .text-slate-500 {
      color: #94a3b8 !important;
    }
    
    .dark-mode .text-slate-400 {
      color: #64748b !important;
    }
    
    .dark-mode .text-slate-700 {
      color: #cbd5e1 !important;
    }
    
    .dark-mode .border-slate-200 {
      border-color: #334155 !important;
    }
    
    .dark-mode .border-slate-100 {
      border-color: #1e293b !important;
    }
    
    .dark-mode .hover\:bg-slate-50:hover {
      background: #1e293b !important;
    }
    
    .dark-mode .gradient-bg {
      background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #1e293b 100%) !important;
    }
    
    .dark-mode .glass-effect {
      background: rgba(30, 41, 59, 0.95) !important;
    }
    
    .dark-mode .bg-gradient-to-br {
      color: #e2e8f0 !important;
    }
    
    @keyframes confetti-fall {
      0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    @keyframes celebration-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes sparkle {
      0%, 100% { transform: scale(0) rotate(0deg); opacity: 0; }
      50% { transform: scale(1) rotate(180deg); opacity: 1; }
    }
    
    .confetti-piece {
      position: fixed;
      width: 10px;
      height: 10px;
      z-index: 9999;
      animation: confetti-fall 4s ease-in forwards;
      pointer-events: none;
    }
    
    .celebration-banner {
      animation: celebration-pulse 2s ease-in-out infinite;
    }
    
    .shimmer-text {
      background: linear-gradient(90deg, #f59e0b, #fbbf24, #f59e0b);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s linear infinite;
      font-family: 'Poppins', sans-serif;
    }
    
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    .sparkle {
      animation: sparkle 1.5s ease-in-out infinite;
    }
    
    .sidebar-item {
      transition: all 0.2s ease;
    }
    
    .sidebar-item:hover {
      background: rgba(59, 130, 246, 0.1);
    }
    
    .sidebar-item.active {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), transparent);
      border-left: 3px solid #3b82f6;
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #1e40af 100%);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      ring: 2px;
      ring-color: #3b82f6;
    }
    
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    
    .dark-mode .scrollbar-thin::-webkit-scrollbar-track {
      background: #1e293b;
    }
    
    .dark-mode .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #475569;
    }
    
    .dark-mode-toggle {
      position: relative;
      width: 60px;
      height: 30px;
      background: #cbd5e1;
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .dark-mode-toggle.active {
      background: #3b82f6;
    }
    
    .dark-mode-toggle-circle {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .dark-mode-toggle.active .dark-mode-toggle-circle {
      transform: translateX(30px);
    }
    
    .star-crown {
      filter: drop-shadow(0 0 20px rgba(251, 191, 36, 0.8));
    }
    
    .attendance-day {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      background: #e2e8f0;
    }
    
    .attendance-day.active {
      background: #10b981;
    }
    
    .attendance-day.partial {
      background: #f59e0b;
    }
    
    .delete-btn:hover {
      transform: scale(1.1);
    }

    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* MOBILE RESPONSIVE STYLES */
    .sidebar {
      position: fixed;
      left: -100%;
      top: 0;
      bottom: 0;
      width: 280px;
      z-index: 100;
      transition: left 0.3s ease;
    }

    .sidebar.open {
      left: 0;
    }

    .mobile-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
    }

    .mobile-overlay.active {
      display: block;
    }

    .hamburger {
      display: flex;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
      padding: 8px;
    }

    .hamburger span {
      width: 24px;
      height: 2px;
      background: currentColor;
      border-radius: 2px;
      transition: all 0.3s;
    }

    /* Message Bubble Styles */
    .message-bubble {
      max-width: 70%;
      word-wrap: break-word;
      animation: slideIn 0.3s ease;
    }

    .message-bubble.sent {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      margin-left: auto;
      border-radius: 18px 18px 4px 18px;
    }

    .message-bubble.received {
      background: #f1f5f9;
      margin-right: auto;
      border-radius: 18px 18px 18px 4px;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .messages-container {
      scroll-behavior: smooth;
    }

    /* Attendance Calendar Styles */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day {
      aspect-ratio: 1;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .calendar-day:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .calendar-day.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      pointer-events: none;
    }

    .calendar-day.present {
      background: #10b981;
      border-color: #059669;
      color: white;
    }

    .calendar-day.absent {
      background: #ef4444;
      border-color: #dc2626;
      color: white;
    }

    .calendar-day.wfh {
      background: #f59e0b;
      border-color: #d97706;
      color: white;
    }

    .calendar-day.leave {
      background: #3b82f6;
      border-color: #2563eb;
      color: white;
    }

    .calendar-day.today {
      border-width: 3px;
      border-color: #3b82f6;
    }

    .attendance-badge {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin: 0 2px;
    }

    .attendance-badge.present { background: #10b981; }
    .attendance-badge.absent { background: #ef4444; }
    .attendance-badge.wfh { background: #f59e0b; }
    .attendance-badge.leave { background: #3b82f6; }

    .attendance-stats-bar {
      display: flex;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      background: #e2e8f0;
    }

    .attendance-stats-bar .segment {
      height: 100%;
    }

    .attendance-stats-bar .segment.present { background: #10b981; }
    .attendance-stats-bar .segment.absent { background: #ef4444; }
    .attendance-stats-bar .segment.wfh { background: #f59e0b; }
    .attendance-stats-bar .segment.leave { background: #3b82f6; }

    @media (min-width: 769px) {
      .sidebar {
        position: relative;
        left: 0;
        width: 256px;
      }

      .mobile-only {
        display: none !important;
      }

      .mobile-overlay {
        display: none !important;
      }
    }

    @media (max-width: 768px) {
      .desktop-only {
        display: none !important;
      }

      .card-hover:hover {
        transform: none;
      }

      h1 {
        font-size: 1.5rem !important;
      }

      h2 {
        font-size: 1.25rem !important;
      }

      h3 {
        font-size: 1rem !important;
      }

      .message-bubble {
        max-width: 85%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-slate-50">
  <div id="app" class="h-full w-full flex items-center justify-center">
   <div class="loading-spinner"></div>
  </div>
  <script>
    // ï¿½ï¿½ï¿½ FIREBASE CONFIGURATION - Your Sai Soft Infosys Project
    const firebaseConfig = {
      apiKey: "AIzaSyCkO6JDCmU66zAJwO1kJ2yVOPdYAzvSm5o",
      authDomain: "sai-soft-infosys-fc440.firebaseapp.com",
      projectId: "sai-soft-infosys-fc440",
      storageBucket: "sai-soft-infosys-fc440.firebasestorage.app",
      messagingSenderId: "242076702238",
      appId: "1:242076702238:web:b753e58989872e8249000f"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const collectionName = 'saisoftInterns';

    // Default configuration
    const defaultConfig = {
      company_name: 'Sai Soft Infosys',
      tagline: 'Empowering Future Tech Leaders',
      primary_color: '#1e40af',
      secondary_color: '#3b82f6',
      background_color: '#f8fafc',
      text_color: '#1e293b',
      accent_color: '#f59e0b'
    };

    // Application State
    let config = { ...defaultConfig };
    let appData = {
      interns: [],
      tasks: [],
      submissions: [],
      tickets: [],
      attendance: [],
      projects: [],
      teams: [],
      meetings: [],
      settings: [],
      messages: [],
      teamMessages: []
    };
    let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
    let currentPage = localStorage.getItem('currentPage') || 'dashboard';
    let darkMode = localStorage.getItem('darkMode') === 'true';
    let modals = {};
    let selectedInternId = null;
    let selectedDates = [];
    let confirmDelete = null;
    let unsubscribeFirestore = null;
    let sidebarOpen = false;
    let editingIntern = null;
    let selectedTeamId = null;

    // Admin credentials
    const ADMIN_EMAIL = 'admin@saisoft';
    const ADMIN_PASSWORD = 'Saisoft@2026';

    // Icons
    const icons = {
      home: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`,
      users: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
      clipboard: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="8" height="4" x="8" y="2" rx="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>`,
      briefcase: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>`,
      usersGroup: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
      calendar: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>`,
      ticket: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></svg>`,
      checkCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
      logout: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>`,
      plus: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>`,
      x: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,
      mail: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>`,
      user: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
      sun: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`,
      moon: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>`,
      trash: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>`,
      star: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`,
      menu: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>`,
      messageCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>`,
      send: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>`
    };

    // Generate unique ID
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    // Get avatar
    function getAvatar(name, photoUrl) {
      if (photoUrl && photoUrl.trim()) {
        let imageUrl = photoUrl;
        if (photoUrl.includes('drive.google.com')) {
          const match = photoUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);
          if (match) {
            imageUrl = `https://drive.google.com/uc?export=view&id=${match[1]}`;
          }
        }
        return `<img src="${imageUrl}" alt="${name}" class="w-full h-full object-cover" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div class=\\'w-full h-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white font-bold text-lg\\'>${name.charAt(0).toUpperCase()}</div>';">`;
      }
      return `<div class="w-full h-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white font-bold text-lg">${name.charAt(0).toUpperCase()}</div>`;
    }

    // Get current date info
    function getCurrentDateInfo() {
      const now = new Date();
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      return {
        dayName: days[now.getDay()],
        day: now.getDate(),
        month: months[now.getMonth()],
        year: now.getFullYear(),
        fullDate: now.toISOString().split('T')[0]
      };
    }

    // Trigger confetti
    function triggerConfetti() {
      const colors = ['#f59e0b', '#fbbf24', '#3b82f6', '#8b5cf6', '#ec4899'];
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti-piece';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 5000);
        }, i * 30);
      }
    }

    // Get star intern
    function getStarIntern() {
      return appData.interns.find(i => i.isStarIntern === true);
    }

    // Toggle dark mode
    function toggleDarkMode() {
      darkMode = !darkMode;
      localStorage.setItem('darkMode', darkMode);
      document.body.classList.toggle('dark-mode', darkMode);
      render();
    }

    // Toggle sidebar
    function toggleSidebar() {
      sidebarOpen = !sidebarOpen;
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.mobile-overlay');
      if (sidebar) {
        sidebar.classList.toggle('open', sidebarOpen);
      }
      if (overlay) {
        overlay.classList.toggle('active', sidebarOpen);
      }
    }

    function closeSidebar() {
      sidebarOpen = false;
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.mobile-overlay');
      if (sidebar) {
        sidebar.classList.remove('open');
      }
      if (overlay) {
        overlay.classList.remove('active');
      }
    }

    if (darkMode) {
      document.body.classList.add('dark-mode');
    }

    // Get attendance stats
    function getAttendanceStats(internId) {
      const attendance = appData.attendance.filter(a => a.internId === internId);
      const stats = {
        present: 0,
        absent: 0,
        wfh: 0,
        leave: 0,
        total: 0,
        records: attendance,
        byDate: {}
      };
      
      attendance.forEach(record => {
        if (record.date && record.status) {
          stats.byDate[record.date] = record.status;
          stats[record.status]++;
          stats.total++;
        }
      });
      
      return stats;
    }

    // Calendar helper functions
    function getDaysInMonth(year, month) {
      return new Date(year, month + 1, 0).getDate();
    }

    function getFirstDayOfMonth(year, month) {
      return new Date(year, month, 1).getDay();
    }

    let currentCalendarDate = new Date();
    let currentAttendanceInternId = null;

    // ðŸ”¥ FIREBASE REAL-TIME SYNC
    function startFirestoreSync() {
      if (unsubscribeFirestore) {
        unsubscribeFirestore();
      }

      unsubscribeFirestore = db.collection(collectionName).onSnapshot((snapshot) => {
        const allData = [];
        snapshot.forEach((doc) => {
          allData.push({ ...doc.data(), __firestoreId: doc.id });
        });

        appData.interns = allData.filter(d => d.type === 'intern');
        appData.tasks = allData.filter(d => d.type === 'task');
        appData.submissions = allData.filter(d => d.type === 'submission');
        appData.tickets = allData.filter(d => d.type === 'ticket');
        appData.attendance = allData.filter(d => d.type === 'attendance');
        appData.projects = allData.filter(d => d.type === 'project');
        appData.teams = allData.filter(d => d.type === 'team');
        appData.meetings = allData.filter(d => d.type === 'meeting');
        appData.settings = allData.filter(d => d.type === 'settings');
        appData.messages = allData.filter(d => d.type === 'message');
        appData.teamMessages = allData.filter(d => d.type === 'teamMessage');

        // Auto-scroll messages to bottom if on intern space page
        if (currentPage === 'intern-space') {
          setTimeout(scrollMessagesToBottom, 100);
        }

        // Only re-render if NOT in attendance modal to prevent scroll jump
        if (!modals.attendance) {
          render();
        } else {
          // Just update the attendance calendar without full re-render
          updateAttendanceCalendarOnly();
        }
      }, (error) => {
        console.error('Firestore sync error:', error);
      });
    }

    // ðŸ”¥ FIREBASE OPERATIONS
    async function createFirestoreDoc(data) {
      try {
        await db.collection(collectionName).add({
          ...data,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        return { success: true };
      } catch (error) {
        console.error('Create error:', error);
        return { success: false, error };
      }
    }

    async function updateFirestoreDoc(data) {
      try {
        if (!data.__firestoreId) {
          throw new Error('No Firestore ID found');
        }
        const docRef = db.collection(collectionName).doc(data.__firestoreId);
        const { __firestoreId, ...updateData } = data;
        await docRef.update({
          ...updateData,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        return { success: true };
      } catch (error) {
        console.error('Update error:', error);
        return { success: false, error };
      }
    }

    async function deleteFirestoreDoc(data) {
      try {
        if (!data.__firestoreId) {
          throw new Error('No Firestore ID found');
        }
        await db.collection(collectionName).doc(data.__firestoreId).delete();
        return { success: true };
      } catch (error) {
        console.error('Delete error:', error);
        return { success: false, error };
      }
    }

    // Initialize
    async function initApp() {
      try {
        startFirestoreSync();
        render();
      } catch (error) {
        console.error('Init error:', error);
        document.getElementById('app').innerHTML = `
          <div class="text-center p-8">
            <h2 class="text-2xl font-bold text-red-600 mb-4">Connection Error</h2>
            <p class="text-slate-600">Unable to connect to Firebase. Please check your configuration.</p>
          </div>
        `;
      }
    }

    // Star Intern Banner
    function renderStarInternBanner() {
      const starIntern = getStarIntern();
      if (!starIntern) return '';

      return `
        <div class="mb-6 md:mb-8 relative overflow-hidden">
          <div class="celebration-banner relative rounded-2xl md:rounded-3xl overflow-hidden shadow-2xl">
            <div class="absolute inset-0 bg-gradient-to-r from-yellow-300 via-amber-400 to-orange-400 animate-pulse"></div>
            
            <div class="absolute inset-0 opacity-30">
              <div class="absolute top-10 left-20 w-2 h-2 bg-white rounded-full sparkle desktop-only"></div>
              <div class="absolute top-20 right-32 w-3 h-3 bg-white rounded-full sparkle desktop-only" style="animation-delay: 0.3s"></div>
              <div class="absolute bottom-16 left-40 w-2 h-2 bg-white rounded-full sparkle desktop-only" style="animation-delay: 0.6s"></div>
            </div>
            
            <div class="relative p-6 md:p-10">
              <div class="flex flex-col md:flex-row items-center gap-4 md:gap-8">
                <div class="relative flex-shrink-0">
                  <div class="absolute inset-0 bg-yellow-400 rounded-full blur-2xl opacity-50 animate-pulse"></div>
                  <div class="relative w-24 h-24 md:w-32 md:h-32 rounded-full overflow-hidden border-4 border-white shadow-2xl ring-4 ring-yellow-300">
                    ${getAvatar(starIntern.name, starIntern.photoUrl)}
                  </div>
                  <div class="absolute -top-3 -right-3 md:-top-4 md:-right-4 w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-full flex items-center justify-center shadow-lg float-animation">
                    <svg class="w-6 h-6 md:w-10 md:h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                    </svg>
                  </div>
                </div>
                
                <div class="flex-1 text-center md:text-left">
                  <div class="flex flex-col md:flex-row items-center justify-center md:justify-start gap-2 md:gap-3 mb-3">
                    <svg class="w-8 h-8 md:w-10 md:h-10 text-white drop-shadow-lg" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                    </svg>
                    <h2 class="text-2xl md:text-4xl font-black text-white drop-shadow-2xl tracking-tight">
                      STAR INTERN
                    </h2>
                  </div>
                  <div class="mb-2">
                    <span class="inline-block px-4 py-2 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg mb-2">
                      <p class="text-xl md:text-2xl font-black bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent">
                        ${starIntern.name}
                      </p>
                    </span>
                  </div>
                  <div class="flex flex-wrap items-center justify-center md:justify-start gap-2 md:gap-3">
                    <span class="px-3 py-1 md:px-4 md:py-2 bg-white/80 backdrop-blur-sm rounded-lg text-amber-900 font-bold text-xs md:text-sm shadow-md">
                      ${starIntern.role || 'Intern'}
                    </span>
                    <span class="px-3 py-1 md:px-4 md:py-2 bg-white/80 backdrop-blur-sm rounded-lg text-amber-900 font-bold text-xs md:text-sm shadow-md flex items-center gap-2">
                      <svg class="w-3 h-3 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                      </svg>
                      OF THE WEEK
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-white to-transparent opacity-50"></div>
            </div>
          </div>
        </div>
      `;
    }

    // Login Page
    function renderLoginPage() {
      return `
        <div class="h-full flex items-center justify-center gradient-bg p-4">
          <div class="w-full max-w-md">
            <div class="glass-effect rounded-2xl shadow-2xl p-6 md:p-8">
              <div class="text-center mb-6 md:mb-8">
                <div class="w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
                  <span class="text-white text-2xl md:text-3xl font-bold">SS</span>
                </div>
                <h1 class="text-xl md:text-2xl font-bold text-slate-800">${config.company_name || defaultConfig.company_name}</h1>
                <p class="text-sm md:text-base text-slate-500 mt-1">${config.tagline || defaultConfig.tagline}</p>
              </div>
              
              <form id="loginForm" class="space-y-4 md:space-y-5">
                <div>
                  <label for="loginEmail" class="block text-sm font-medium text-slate-700 mb-2">Email Address</label>
                  <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">${icons.mail}</span>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required
                      class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-base">
                  </div>
                </div>
                
                <div>
                  <label for="loginPassword" class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                  <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">${icons.user}</span>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required
                      class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-base">
                  </div>
                </div>
                
                <div id="loginError" class="hidden text-red-500 text-sm text-center bg-red-50 p-3 rounded-lg"></div>
                
                <button type="submit" 
                  class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 transition-all shadow-lg hover:shadow-xl text-base">
                  Sign In
                </button>
              </form>
              
              <p class="text-center text-slate-400 text-xs md:text-sm mt-4 md:mt-6">
                ðŸ”¥ Real-Time Sync Enabled ï¿½ï¿½ Secure Access
              </p>
            </div>
          </div>
        </div>
      `;
    }

    // Sidebar
    function renderSidebar() {
      const isAdmin = currentUser.role === 'admin';
      const menuItems = isAdmin ? [
        { id: 'dashboard', label: 'Dashboard', icon: icons.home },
        { id: 'interns', label: 'Interns', icon: icons.users },
        { id: 'tasks', label: 'Tasks', icon: icons.clipboard },
        { id: 'projects', label: 'Projects', icon: icons.briefcase },
        { id: 'teams', label: 'Teams', icon: icons.usersGroup },
        { id: 'attendance', label: 'Attendance', icon: icons.calendar },
        { id: 'tickets', label: 'Tickets', icon: icons.ticket },
        { id: 'intern-space', label: 'Intern Space', icon: icons.messageCircle }
      ] : [
        { id: 'dashboard', label: 'Dashboard', icon: icons.home },
        { id: 'my-tasks', label: 'My Tasks', icon: icons.clipboard },
        { id: 'my-projects', label: 'My Projects', icon: icons.briefcase },
        { id: 'my-team', label: 'My Team', icon: icons.usersGroup },
        { id: 'submit-ticket', label: 'Support', icon: icons.ticket },
        { id: 'intern-space', label: 'Intern Space', icon: icons.messageCircle }
      ];

      return `
        <aside class="sidebar w-64 bg-white border-r border-slate-200 flex flex-col h-full ${sidebarOpen ? 'open' : ''}">
          <div class="p-4 md:p-6 border-b border-slate-200">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl flex items-center justify-center">
                  <span class="text-white font-bold text-sm">SS</span>
                </div>
                <div>
                  <h2 class="font-bold text-slate-800 text-sm">${config.company_name || defaultConfig.company_name}</h2>
                  <p class="text-xs text-slate-500">${isAdmin ? 'Admin' : 'Intern'} Portal</p>
                </div>
              </div>
              <button onclick="toggleSidebar()" class="mobile-only text-slate-600">
                ${icons.x}
              </button>
            </div>
          </div>
          
          <div class="p-4 border-b border-slate-200">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0">
                ${getAvatar(currentUser.name, currentUser.photoUrl)}
              </div>
              <div class="flex-1 min-w-0">
                <p class="font-semibold text-slate-800 text-sm truncate">${currentUser.name}</p>
                <p class="text-xs text-slate-500 truncate">${currentUser.role}</p>
              </div>
            </div>
          </div>
          
          <nav class="flex-1 p-4 space-y-1 overflow-y-auto scrollbar-thin">
            ${menuItems.map(item => `
              <button onclick="navigateTo('${item.id}')" 
                class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 hover:text-slate-900 ${currentPage === item.id ? 'active text-blue-600' : ''}">
                <span class="${currentPage === item.id ? 'text-blue-600' : 'text-slate-400'}">${item.icon}</span>
                <span class="font-medium text-sm">${item.label}</span>
              </button>
            `).join('')}
          </nav>
          
          <div class="p-4 border-t border-slate-200">
            <div class="flex items-center justify-between mb-4">
              <span class="text-sm text-slate-600 font-medium">Dark Mode</span>
              <button onclick="toggleDarkMode()" class="dark-mode-toggle ${darkMode ? 'active' : ''}">
                <div class="dark-mode-toggle-circle">
                  ${darkMode ? icons.moon : icons.sun}
                </div>
              </button>
            </div>
            <button onclick="logout()" 
              class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors">
              ${icons.logout}
              <span class="font-medium text-sm">Sign Out</span>
            </button>
          </div>
        </aside>
      `;
    }

    // Mobile Header
    function renderMobileHeader() {
      return `
        <div class="mobile-only sticky top-0 z-50 bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between">
          <button onclick="toggleSidebar()" class="text-slate-600 p-2">
            ${icons.menu}
          </button>
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg flex items-center justify-center">
              <span class="text-white font-bold text-xs">SS</span>
            </div>
            <h2 class="font-bold text-slate-800 text-sm">${config.company_name || defaultConfig.company_name}</h2>
          </div>
          <div class="w-8 h-8"></div>
        </div>
      `;
    }

    // Admin Dashboard
    function renderAdminDashboard() {
      const dateInfo = getCurrentDateInfo();
      const activeInterns = appData.interns.filter(i => i.status === 'active').length;
      const pendingTickets = appData.tickets.filter(t => t.ticketStatus === 'open').length;
      
      return `
        <div class="p-4 md:p-8">
          ${renderStarInternBanner()}
          
          <div class="mb-6 md:mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800">Welcome back, Admin! ï¿½ï¿½</h1>
            <p class="text-sm md:text-base text-slate-500 mt-1">${dateInfo.dayName}, ${dateInfo.month} ${dateInfo.day}, ${dateInfo.year}</p>
          </div>
          
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6">
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 md:p-6 text-white card-hover">
              <div class="text-2xl md:text-4xl mb-2">${icons.users}</div>
              <h3 class="text-2xl md:text-3xl font-bold">${activeInterns}</h3>
              <p class="text-blue-100 text-xs md:text-sm">Active Interns</p>
            </div>
            
            <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 md:p-6 text-white card-hover">
              <div class="text-2xl md:text-4xl mb-2">${icons.clipboard}</div>
              <h3 class="text-2xl md:text-3xl font-bold">${appData.tasks.length}</h3>
              <p class="text-purple-100 text-xs md:text-sm">Total Tasks</p>
            </div>
            
            <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 md:p-6 text-white card-hover">
              <div class="text-2xl md:text-4xl mb-2">${icons.briefcase}</div>
              <h3 class="text-2xl md:text-3xl font-bold">${appData.projects.length}</h3>
              <p class="text-green-100 text-xs md:text-sm">Active Projects</p>
            </div>
            
            <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 md:p-6 text-white card-hover">
              <div class="text-2xl md:text-4xl mb-2">${icons.ticket}</div>
              <h3 class="text-2xl md:text-3xl font-bold">${pendingTickets}</h3>
              <p class="text-orange-100 text-xs md:text-sm">Open Tickets</p>
            </div>
          </div>
        </div>
      `;
    }

    // Intern Dashboard
    function renderInternDashboard() {
      const dateInfo = getCurrentDateInfo();
      const myTasks = appData.tasks.filter(t => t.assignedTo === currentUser.id || t.assignedTo === 'all');
      const mySubmissions = appData.submissions.filter(s => s.submittedBy === currentUser.id);
      const myTickets = appData.tickets.filter(t => t.raisedBy === currentUser.id);
      const attendanceStats = getAttendanceStats(currentUser.id);
      
      // Motivational quotes
      const quotes = [
        { text: "Code is like humor. When you have to explain it, it's bad.", author: "Cory House" },
        { text: "First, solve the problem. Then, write the code.", author: "John Johnson" },
        { text: "Learning to code is learning to create and innovate.", author: "Codecademy" },
        { text: "The best error message is the one that never shows up.", author: "Thomas Fuchs" },
        { text: "Every expert was once a beginner.", author: "Helen Hayes" },
        { text: "Code never lies, comments sometimes do.", author: "Ron Jeffries" },
        { text: "Make it work, make it right, make it fast.", author: "Kent Beck" },
        { text: "Programs must be written for people to read.", author: "Harold Abelson" },
        { text: "The only way to learn a new language is by writing programs in it.", author: "Dennis Ritchie" },
        { text: "Simplicity is the soul of efficiency.", author: "Austin Freeman" }
      ];
      
      const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
      
      // Get last 7 days attendance
      const last7Days = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        const status = attendanceStats.byDate[dateStr] || 'none';
        last7Days.push({
          day: date.toLocaleDateString('en-US', { weekday: 'short' }),
          date: date.getDate(),
          status: status
        });
      }
      
      // Calculate attendance percentage
      const attendancePercentage = attendanceStats.total > 0 
        ? Math.round((attendanceStats.present / attendanceStats.total) * 100) 
        : 0;
      
      return `
        <div class="p-4 md:p-8">
          ${renderStarInternBanner()}
          
          <!-- Energetic Header with Quote -->
          <div class="mb-6 md:mb-8 relative overflow-hidden">
            <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 rounded-3xl p-6 md:p-8 text-white shadow-2xl relative">
              <div class="absolute inset-0 opacity-20">
                <div class="absolute top-0 left-0 w-64 h-64 bg-white rounded-full blur-3xl animate-pulse"></div>
                <div class="absolute bottom-0 right-0 w-96 h-96 bg-yellow-300 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
              </div>
              
              <div class="relative">
                <div class="flex items-center gap-3 mb-4">
                  <div class="w-12 h-12 md:w-16 md:h-16 rounded-full overflow-hidden border-4 border-white shadow-lg ring-4 ring-white/30">
                    ${getAvatar(currentUser.name, currentUser.photoUrl)}
                  </div>
                  <div class="flex-1">
                    <h1 class="text-2xl md:text-4xl font-black mb-1 drop-shadow-lg">Welcome back, ${currentUser.name}! ðŸŽ‰</h1>
                    <p class="text-sm md:text-lg text-white/90 font-medium">${dateInfo.dayName}, ${dateInfo.month} ${dateInfo.day}, ${dateInfo.year}</p>
                  </div>
                </div>
                
                <!-- Inspirational Quote -->
                <div class="mt-6 bg-white/10 backdrop-blur-md rounded-2xl p-4 md:p-6 border-2 border-white/20">
                  <div class="flex items-start gap-3">
                    <svg class="w-8 h-8 md:w-12 md:h-12 text-yellow-300 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                    </svg>
                    <div class="flex-1">
                      <p class="text-base md:text-xl font-semibold mb-2 leading-relaxed">"${randomQuote.text}"</p>
                      <p class="text-sm md:text-base text-white/80 font-medium">â€” ${randomQuote.author}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Stats Cards with Animations -->
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-8">
            <div class="bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl p-4 md:p-6 text-white card-hover shadow-xl transform hover:scale-105 transition-all duration-300">
              <div class="flex items-center gap-2 md:gap-3 mb-3">
                <div class="w-12 h-12 md:w-14 md:h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                  ${icons.clipboard}
                </div>
                <h3 class="font-bold text-xs md:text-sm">My Tasks</h3>
              </div>
              <p class="text-3xl md:text-4xl font-black mb-1">${myTasks.length}</p>
              <p class="text-xs md:text-sm text-blue-100">Assigned to you</p>
            </div>
            
            <div class="bg-gradient-to-br from-green-500 to-emerald-700 rounded-2xl p-4 md:p-6 text-white card-hover shadow-xl transform hover:scale-105 transition-all duration-300">
              <div class="flex items-center gap-2 md:gap-3 mb-3">
                <div class="w-12 h-12 md:w-14 md:h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                  ${icons.checkCircle}
                </div>
                <h3 class="font-bold text-xs md:text-sm">Submissions</h3>
              </div>
              <p class="text-3xl md:text-4xl font-black mb-1">${mySubmissions.length}</p>
              <p class="text-xs md:text-sm text-green-100">Tasks submitted</p>
            </div>
            
            <div class="bg-gradient-to-br from-purple-500 to-purple-700 rounded-2xl p-4 md:p-6 text-white card-hover shadow-xl transform hover:scale-105 transition-all duration-300">
              <div class="flex items-center gap-2 md:gap-3 mb-3">
                <div class="w-12 h-12 md:w-14 md:h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                  ${icons.calendar}
                </div>
                <h3 class="font-bold text-xs md:text-sm">Attendance</h3>
              </div>
              <p class="text-3xl md:text-4xl font-black mb-1">${attendanceStats.present}</p>
              <p class="text-xs md:text-sm text-purple-100">Days present</p>
            </div>
            
            <div class="bg-gradient-to-br from-orange-500 to-red-700 rounded-2xl p-4 md:p-6 text-white card-hover shadow-xl transform hover:scale-105 transition-all duration-300">
              <div class="flex items-center gap-2 md:gap-3 mb-3">
                <div class="w-12 h-12 md:w-14 md:h-14 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                  ${icons.ticket}
                </div>
                <h3 class="font-bold text-xs md:text-sm">Support</h3>
              </div>
              <p class="text-3xl md:text-4xl font-black mb-1">${myTickets.length}</p>
              <p class="text-xs md:text-sm text-orange-100">Tickets raised</p>
            </div>
          </div>
          
          <!-- Beautiful Attendance Section -->
          <div class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-3xl p-1 mb-8 shadow-2xl">
            <div class="bg-white rounded-3xl p-6 md:p-8">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <h2 class="text-xl md:text-2xl font-bold text-slate-800 mb-2">ðŸ“Š My Attendance Overview</h2>
                  <p class="text-slate-600 text-sm">Track your presence and engagement</p>
                </div>
                <button onclick="openAttendanceModal('${currentUser.id}')" 
                  class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-md hover:shadow-lg text-sm font-medium">
                  View Full Calendar
                </button>
              </div>
              
              <!-- Attendance Stats Grid -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-4 border-2 border-green-200">
                  <div class="flex items-center gap-2 mb-2">
                    <div class="w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center shadow-md">
                      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                      </svg>
                    </div>
                    <span class="text-xs font-semibold text-green-700">PRESENT</span>
                  </div>
                  <p class="text-3xl font-bold text-green-700">${attendanceStats.present}</p>
                  <p class="text-xs text-green-600 mt-1">Days</p>
                </div>
                
                <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-4 border-2 border-amber-200">
                  <div class="flex items-center gap-2 mb-2">
                    <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center shadow-md">
                      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                      </svg>
                    </div>
                    <span class="text-xs font-semibold text-amber-700">WFH</span>
                  </div>
                  <p class="text-3xl font-bold text-amber-700">${attendanceStats.wfh}</p>
                  <p class="text-xs text-amber-600 mt-1">Days</p>
                </div>
                
                <div class="bg-gradient-to-br from-red-50 to-rose-50 rounded-2xl p-4 border-2 border-red-200">
                  <div class="flex items-center gap-2 mb-2">
                    <div class="w-10 h-10 bg-red-500 rounded-xl flex items-center justify-center shadow-md">
                      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                    </div>
                    <span class="text-xs font-semibold text-red-700">ABSENT</span>
                  </div>
                  <p class="text-3xl font-bold text-red-700">${attendanceStats.absent}</p>
                  <p class="text-xs text-red-600 mt-1">Days</p>
                </div>
                
                <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-4 border-2 border-blue-200">
                  <div class="flex items-center gap-2 mb-2">
                    <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center shadow-md">
                      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <span class="text-xs font-semibold text-blue-700">LEAVE</span>
                  </div>
                  <p class="text-3xl font-bold text-blue-700">${attendanceStats.leave}</p>
                  <p class="text-xs text-blue-600 mt-1">Days</p>
                </div>
              </div>
              
              <!-- Last 7 Days Timeline -->
              <div class="bg-gradient-to-r from-slate-50 to-indigo-50 rounded-2xl p-6 border border-slate-200">
                <h3 class="font-bold text-slate-800 mb-4 text-sm">Last 7 Days Activity</h3>
                <div class="grid grid-cols-7 gap-2">
                  ${last7Days.map(day => {
                    let bgClass = 'bg-slate-200';
                    let iconHtml = '';
                    
                    if (day.status === 'present') {
                      bgClass = 'bg-gradient-to-br from-green-400 to-green-600';
                      iconHtml = '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                    } else if (day.status === 'wfh') {
                      bgClass = 'bg-gradient-to-br from-amber-400 to-amber-600';
                      iconHtml = '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>';
                    } else if (day.status === 'absent') {
                      bgClass = 'bg-gradient-to-br from-red-400 to-red-600';
                      iconHtml = '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
                    } else if (day.status === 'leave') {
                      bgClass = 'bg-gradient-to-br from-blue-400 to-blue-600';
                      iconHtml = '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                    }
                    
                    return `
                      <div class="text-center">
                        <p class="text-xs font-medium text-slate-600 mb-2">${day.day}</p>
                        <div class="${bgClass} rounded-xl p-3 flex flex-col items-center justify-center shadow-md transition-transform hover:scale-105">
                          ${iconHtml}
                          <p class="${day.status !== 'none' ? 'text-white' : 'text-slate-500'} text-sm font-bold mt-1">${day.date}</p>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
              
              <!-- Attendance Progress Bar -->
              <div class="mt-6">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-semibold text-slate-700">Attendance Rate</span>
                  <span class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">${attendancePercentage}%</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-4 overflow-hidden shadow-inner">
                  <div class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 h-full rounded-full transition-all duration-500 shadow-lg" 
                       style="width: ${attendancePercentage}%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Interns Management
    function renderInternsPage() {
      const starIntern = getStarIntern();
      
      return `
        <div class="p-4 md:p-8">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 md:mb-8">
            <div>
              <h1 class="text-xl md:text-2xl font-bold text-slate-800">Intern Management</h1>
              <p class="text-sm md:text-base text-slate-500">Manage your team â€¢ ðŸ”¥ Live Sync</p>
            </div>
            <button onclick="openModal('addIntern')" 
              class="w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
              ${icons.plus}
              <span>Add Intern</span>
            </button>
          </div>
          
          ${starIntern ? `
            <div class="mb-6 md:mb-8 bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-200 rounded-xl md:rounded-2xl p-4 md:p-6">
              <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 md:gap-4 mb-3">
                <div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-full flex items-center justify-center shadow-lg">
                  <svg class="w-5 h-5 md:w-7 md:h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                  </svg>
                </div>
                <div class="flex-1">
                  <h3 class="text-base md:text-lg font-bold text-amber-900">Current Star Intern</h3>
                  <p class="text-xs md:text-sm text-amber-700">Featured across all dashboards</p>
                </div>
              </div>
              <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 md:gap-4 p-3 md:p-4 bg-white rounded-xl border border-amber-200">
                <div class="w-12 h-12 md:w-16 md:h-16 rounded-full overflow-hidden border-2 border-amber-400 shadow-md">
                  ${getAvatar(starIntern.name, starIntern.photoUrl)}
                </div>
                <div class="flex-1">
                  <p class="font-bold text-slate-800 text-base md:text-lg">${starIntern.name}</p>
                  <p class="text-slate-600 text-xs md:text-sm">${starIntern.role}</p>
                </div>
                <button onclick="removeStarIntern('${starIntern.id}')" 
                  class="w-full sm:w-auto px-3 md:px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-xs md:text-sm font-medium">
                  Remove Star
                </button>
              </div>
            </div>
          ` : ''}
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
            ${appData.interns.length > 0 ? appData.interns.map(intern => {
              const attendanceStats = getAttendanceStats(intern.id);
              const isStarIntern = intern.isStarIntern === true;
              
              const presentPercent = attendanceStats.total > 0 ? (attendanceStats.present / attendanceStats.total * 100) : 0;
              const absentPercent = attendanceStats.total > 0 ? (attendanceStats.absent / attendanceStats.total * 100) : 0;
              const wfhPercent = attendanceStats.total > 0 ? (attendanceStats.wfh / attendanceStats.total * 100) : 0;
              
              return `
                <div class="bg-white rounded-xl p-4 md:p-6 border ${isStarIntern ? 'border-amber-300 ring-2 ring-amber-200' : 'border-slate-200'} card-hover relative overflow-hidden">
                  ${isStarIntern ? `
                    <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-yellow-400 via-amber-400 to-orange-400"></div>
                    <div class="absolute -top-8 -right-8 w-24 h-24 bg-amber-100 rounded-full opacity-50"></div>
                  ` : ''}
                  
                  <div class="relative">
                    <div class="flex items-start gap-3 md:gap-4 mb-4">
                      <div class="relative">
                        <div class="w-14 h-14 md:w-16 md:h-16 rounded-full overflow-hidden flex-shrink-0 ${isStarIntern ? 'ring-2 ring-amber-400' : ''}">
                          ${getAvatar(intern.name, intern.photoUrl)}
                        </div>
                        ${isStarIntern ? `
                          <div class="absolute -bottom-1 -right-1 w-5 h-5 md:w-6 md:h-6 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-full flex items-center justify-center shadow-md">
                            <svg class="w-3 h-3 md:w-4 md:h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                            </svg>
                          </div>
                        ` : ''}
                      </div>
                      <div class="flex-1 min-w-0">
                        <h3 class="font-bold text-slate-800 truncate text-sm md:text-base">${intern.name}</h3>
                        <p class="text-xs md:text-sm text-slate-500 truncate">${intern.email}</p>
                        <span class="inline-block mt-2 px-2 md:px-3 py-1 ${isStarIntern ? 'bg-gradient-to-r from-amber-100 to-orange-100 text-amber-800 font-bold' : 'bg-blue-100 text-blue-700'} rounded-full text-xs">
                          ${intern.role}
                        </span>
                      </div>
                    </div>
                    
                    <!-- Attendance Visualization -->
                    <div class="mb-4 p-3 bg-slate-50 rounded-lg border border-slate-200">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold text-slate-700">Attendance Overview</span>
                        <span class="text-xs text-slate-500">${attendanceStats.total} days</span>
                      </div>
                      
                      ${attendanceStats.total > 0 ? `
                        <div class="attendance-stats-bar mb-3">
                          ${attendanceStats.present > 0 ? `<div class="segment present" style="width: ${presentPercent}%;"></div>` : ''}
                          ${attendanceStats.wfh > 0 ? `<div class="segment wfh" style="width: ${wfhPercent}%;"></div>` : ''}
                          ${attendanceStats.absent > 0 ? `<div class="segment absent" style="width: ${absentPercent}%;"></div>` : ''}
                        </div>
                        
                        <div class="flex items-center justify-between text-xs">
                          <div class="flex items-center gap-1">
                            <span class="attendance-badge present"></span>
                            <span class="text-slate-600">${attendanceStats.present} Present</span>
                          </div>
                          <div class="flex items-center gap-1">
                            <span class="attendance-badge wfh"></span>
                            <span class="text-slate-600">${attendanceStats.wfh} WFH</span>
                          </div>
                          <div class="flex items-center gap-1">
                            <span class="attendance-badge absent"></span>
                            <span class="text-slate-600">${attendanceStats.absent} Absent</span>
                          </div>
                        </div>
                      ` : `
                        <p class="text-xs text-slate-400 text-center py-2">No attendance records yet</p>
                      `}
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 mb-2">
                      <button onclick="openEditInternModal('${intern.id}')" 
                        class="px-2 md:px-3 py-2 bg-blue-100 text-blue-600 rounded-lg text-xs font-medium hover:bg-blue-200 transition-colors flex items-center justify-center gap-1">
                        <svg class="w-3 h-3 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        <span>Edit</span>
                      </button>
                      ${!isStarIntern ? `
                        <button onclick="setStarIntern('${intern.id}')" 
                          class="px-2 md:px-3 py-2 bg-gradient-to-r from-yellow-400 to-amber-500 text-white rounded-lg text-xs font-bold hover:from-yellow-500 hover:to-amber-600 transition-all shadow-md flex items-center justify-center gap-1">
                          <svg class="w-3 h-3 md:w-4 md:h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                          </svg>
                          <span>Star</span>
                        </button>
                      ` : `
                        <button onclick="removeStarIntern('${intern.id}')" 
                          class="px-2 md:px-3 py-2 bg-slate-100 text-slate-600 rounded-lg text-xs font-medium hover:bg-slate-200 transition-colors">
                          Remove Star
                        </button>
                      `}
                    </div>
                    <button onclick="confirmDeleteIntern('${intern.id}')" 
                      class="w-full px-2 md:px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors text-xs font-medium flex items-center justify-center gap-2">
                      ${icons.trash}
                      <span>Delete Intern</span>
                    </button>
                  </div>
                </div>
              `;
            }).join('') : `
              <div class="col-span-full bg-white rounded-xl p-8 md:p-12 border border-slate-200 text-center text-slate-400">
                <p class="text-base md:text-lg mb-2">No interns yet</p>
                <p class="text-xs md:text-sm">Click "Add Intern" to get started</p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Attendance Page
    function renderAttendancePage() {
      return `
        <div class="p-4 md:p-8">
          <div class="mb-6 md:mb-8">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800">Attendance Management</h1>
            <p class="text-sm md:text-base text-slate-500">Track intern attendance</p>
          </div>
          
          <div class="grid grid-cols-1 gap-4 md:gap-6">
            ${appData.interns.map(intern => {
              const stats = getAttendanceStats(intern.id);
              return `
                <div class="bg-white rounded-xl p-4 md:p-6 border border-slate-200">
                  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-4">
                    <div class="flex items-center gap-3 md:gap-4">
                      <div class="w-10 h-10 md:w-12 md:h-12 rounded-full overflow-hidden">
                        ${getAvatar(intern.name, intern.photoUrl)}
                      </div>
                      <div>
                        <h3 class="font-bold text-slate-800 text-sm md:text-base">${intern.name}</h3>
                        <p class="text-xs md:text-sm text-slate-500">${stats.totalDays} days active</p>
                      </div>
                    </div>
                    <button onclick="openAttendanceModal('${intern.id}')" 
                      class="w-full sm:w-auto px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs md:text-sm font-medium">
                      Update Attendance
                    </button>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    // Tasks Page
    function renderTasksPage() {
      return `
        <div class="p-4 md:p-8">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 md:mb-8">
            <div>
              <h1 class="text-xl md:text-2xl font-bold text-slate-800">Task Management</h1>
              <p class="text-sm md:text-base text-slate-500">Create and manage tasks</p>
            </div>
            <button onclick="openModal('addTask')" 
              class="w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
              ${icons.plus}
              <span>Create Task</span>
            </button>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
            ${appData.tasks.length > 0 ? appData.tasks.map(task => {
              const submissions = appData.submissions.filter(s => s.taskId === task.id);
              return `
                <div class="bg-white rounded-xl p-4 md:p-6 border border-slate-200 card-hover">
                  <div class="flex items-start justify-between mb-3 gap-3">
                    <h3 class="font-bold text-slate-800 flex-1 text-sm md:text-base">${task.title}</h3>
                    <span class="px-2 py-1 text-xs font-medium rounded whitespace-nowrap ${
                      task.priority === 'high' ? 'bg-red-100 text-red-700' :
                      task.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                      'bg-green-100 text-green-700'
                    }">${task.priority || 'low'}</span>
                  </div>
                  <p class="text-slate-600 text-xs md:text-sm mb-4 line-clamp-2">${task.description}</p>
                  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 text-xs md:text-sm">
                    <span class="text-slate-500">Due: ${new Date(task.deadline).toLocaleDateString()}</span>
                    <span class="text-blue-600 font-medium">${submissions.length} submissions</span>
                  </div>
                </div>
              `;
            }).join('') : `
              <div class="col-span-full bg-white rounded-xl p-8 md:p-12 border border-slate-200 text-center text-slate-400">
                <p class="text-sm md:text-base">No tasks yet. Click "Create Task" to add one.</p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Projects Page
    function renderProjectsPage() {
      return `
        <div class="p-4 md:p-8">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 md:mb-8">
            <div>
              <h1 class="text-xl md:text-2xl font-bold text-slate-800">Project Management</h1>
              <p class="text-sm md:text-base text-slate-500">Track ongoing projects</p>
            </div>
            <button onclick="openModal('addProject')" 
              class="w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
              ${icons.plus}
              <span>Add Project</span>
            </button>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
            ${appData.projects.length > 0 ? appData.projects.map(project => `
              <div class="bg-white rounded-xl p-4 md:p-6 border border-slate-200 card-hover">
                <div class="flex items-start justify-between mb-3 gap-3">
                  <h3 class="font-bold text-slate-800 flex-1 text-sm md:text-base">${project.projectTitle}</h3>
                  <span class="px-2 py-1 text-xs font-medium rounded whitespace-nowrap ${
                    project.projectStatus === 'completed' ? 'bg-green-100 text-green-700' :
                    project.projectStatus === 'in-progress' ? 'bg-blue-100 text-blue-700' :
                    'bg-yellow-100 text-yellow-700'
                  }">${project.projectStatus || 'planning'}</span>
                </div>
                <p class="text-slate-600 text-xs md:text-sm mb-4 line-clamp-2">${project.projectDescription}</p>
                ${project.technologies ? `
                  <div class="flex flex-wrap gap-2 mb-4">
                    ${project.technologies.split(',').map(tech => `
                      <span class="px-2 py-1 bg-slate-100 text-slate-700 rounded text-xs">${tech.trim()}</span>
                    `).join('')}
                  </div>
                ` : ''}
                <div class="text-xs md:text-sm text-slate-500">
                  ${project.startDate ? `Started: ${new Date(project.startDate).toLocaleDateString()}` : ''}
                </div>
              </div>
            `).join('') : `
              <div class="col-span-full bg-white rounded-xl p-8 md:p-12 border border-slate-200 text-center text-slate-400">
                <p class="text-sm md:text-base">No projects yet. Click "Add Project" to create one.</p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Teams Page
    function renderTeamsPage() {
      const isAdmin = currentUser.role === 'admin';
      
      return `
        <div class="p-4 md:p-8">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 md:mb-8">
            <div>
              <h1 class="text-xl md:text-2xl font-bold text-slate-800">Team Management ðŸ‘¥</h1>
              <p class="text-sm md:text-base text-slate-500">${isAdmin ? 'Organize and manage teams' : 'Collaborate with your team'}</p>
            </div>
            ${isAdmin ? `
              <button onclick="openModal('addTeam')" 
                class="w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-colors text-sm shadow-md hover:shadow-lg">
                ${icons.plus}
                <span>Create Team</span>
              </button>
            ` : ''}
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6">
            ${appData.teams.length > 0 ? appData.teams.map(team => {
              const memberIds = team.members ? team.members.split(',') : [];
              const members = appData.interns.filter(i => memberIds.includes(i.id));
              const teamTasks = appData.tasks.filter(t => t.teamId === team.id);
              const isMember = memberIds.includes(currentUser.id) || isAdmin;
              
              // Get team messages count
              const teamMessagesCount = appData.teamMessages.filter(m => m.teamId === team.id).length;
              
              return `
                <div class="bg-gradient-to-br from-white to-slate-50 rounded-2xl border-2 border-slate-200 overflow-hidden hover:shadow-2xl transition-all duration-300 hover:-translate-y-1">
                  <!-- Team Header -->
                  <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 p-6 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"></div>
                    <div class="relative">
                      <div class="flex items-center justify-between mb-3">
                        <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg">
                          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                          </svg>
                        </div>
                        ${isMember ? `
                          <span class="px-3 py-1 bg-green-500/80 backdrop-blur-sm rounded-full text-xs font-bold shadow-md">
                            âœ“ MEMBER
                          </span>
                        ` : ''}
                      </div>
                      <h3 class="text-xl font-bold mb-1">${team.teamName}</h3>
                      <p class="text-blue-100 text-sm line-clamp-2">${team.teamDescription}</p>
                    </div>
                  </div>
                  
                  <!-- Team Content -->
                  <div class="p-6">
                    <!-- Team Members -->
                    <div class="mb-4">
                      <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Team Members (${members.length})</p>
                      <div class="flex items-center gap-2 mb-3">
                        ${members.slice(0, 6).map(m => `
                          <div class="w-10 h-10 rounded-full overflow-hidden ring-2 ring-white shadow-md hover:scale-110 transition-transform" title="${m.name}">
                            ${getAvatar(m.name, m.photoUrl)}
                          </div>
                        `).join('')}
                        ${members.length > 6 ? `
                          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-slate-300 to-slate-400 flex items-center justify-center text-white font-bold text-xs shadow-md">
                            +${members.length - 6}
                          </div>
                        ` : ''}
                      </div>
                    </div>
                    
                    <!-- Team Stats -->
                    <div class="grid grid-cols-3 gap-3 mb-4">
                      <div class="bg-blue-50 rounded-xl p-3 text-center border border-blue-100">
                        <svg class="w-5 h-5 text-blue-600 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p class="text-lg font-bold text-blue-700">${teamTasks.length}</p>
                        <p class="text-xs text-blue-600">Tasks</p>
                      </div>
                      
                      <div class="bg-purple-50 rounded-xl p-3 text-center border border-purple-100">
                        <svg class="w-5 h-5 text-purple-600 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"/>
                        </svg>
                        <p class="text-lg font-bold text-purple-700">${teamMessagesCount}</p>
                        <p class="text-xs text-purple-600">Messages</p>
                      </div>
                      
                      <div class="bg-green-50 rounded-xl p-3 text-center border border-green-100">
                        <svg class="w-5 h-5 text-green-600 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                        <p class="text-lg font-bold text-green-700">${members.length}</p>
                        <p class="text-xs text-green-600">Members</p>
                      </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="grid grid-cols-1 gap-2">
                      <button onclick="openTeamModal('${team.id}'); event.stopPropagation();" 
                        class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all shadow-md hover:shadow-lg font-medium text-sm flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                        <span>Open Team Hub</span>
                      </button>
                      ${isAdmin ? `
                        <div class="grid grid-cols-2 gap-2">
                          <button onclick="openEditTeamModal('${team.id}'); event.stopPropagation();" 
                            class="py-2 bg-amber-100 text-amber-700 rounded-lg hover:bg-amber-200 transition-all font-medium text-sm flex items-center justify-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                            <span>Edit</span>
                          </button>
                          <button onclick="confirmDeleteTeam('${team.id}'); event.stopPropagation();" 
                            class="py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-all font-medium text-sm flex items-center justify-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            <span>Delete</span>
                          </button>
                        </div>
                      ` : ''}
                    </div>
                  </div>
                </div>
              `;
            }).join('') : `
              <div class="col-span-full bg-gradient-to-br from-slate-50 to-blue-50 rounded-3xl p-12 md:p-16 border-2 border-dashed border-slate-300 text-center">
                <svg class="w-20 h-20 md:w-24 md:h-24 mx-auto mb-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <h3 class="text-xl md:text-2xl font-bold text-slate-400 mb-3">No Teams Yet</h3>
                <p class="text-sm md:text-base text-slate-500 max-w-md mx-auto">
                  ${isAdmin ? 'Click "Create Team" to organize your interns into collaborative groups' : 'No teams have been created yet. Contact your admin to join a team!'}
                </p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Tickets Page
    function renderTicketsPage() {
      return `
        <div class="p-4 md:p-8">
          <div class="mb-6 md:mb-8">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800">Support Tickets</h1>
            <p class="text-sm md:text-base text-slate-500">Manage intern support requests</p>
          </div>
          
          <div class="space-y-4">
            ${appData.tickets.length > 0 ? appData.tickets.map(ticket => `
              <div class="bg-white rounded-xl p-4 md:p-6 border border-slate-200">
                <div class="flex flex-col sm:flex-row items-start justify-between gap-3 mb-3">
                  <div class="flex-1">
                    <div class="flex flex-wrap items-center gap-2 md:gap-3 mb-2">
                      <h3 class="font-bold text-slate-800 text-sm md:text-base">${ticket.message}</h3>
                      <span class="px-2 py-1 text-xs font-medium rounded ${
                        ticket.priority === 'high' ? 'bg-red-100 text-red-700' :
                        ticket.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                        'bg-blue-100 text-blue-700'
                      }">${ticket.priority || 'low'}</span>
                      <span class="px-2 py-1 text-xs font-medium rounded ${
                        ticket.ticketStatus === 'open' ? 'bg-orange-100 text-orange-700' :
                        'bg-green-100 text-green-700'
                      }">${ticket.ticketStatus}</span>
                    </div>
                    <p class="text-xs md:text-sm text-slate-500">Raised by: ${ticket.raisedByName || 'Unknown'}</p>
                  </div>
                  ${ticket.ticketStatus === 'open' ? `
                    <button onclick="resolveTicket('${ticket.id}')" 
                      class="w-full sm:w-auto px-3 md:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-xs md:text-sm">
                      Resolve
                    </button>
                  ` : ''}
                </div>
              </div>
            `).join('') : `
              <div class="bg-white rounded-xl p-8 md:p-12 border border-slate-200 text-center text-slate-400">
                <p class="text-sm md:text-base">No tickets yet</p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Intern My Tasks
    function renderMyTasksPage() {
      const myTasks = appData.tasks.filter(t => t.assignedTo === currentUser.id || t.assignedTo === 'all');
      
      return `
        <div class="p-4 md:p-8">
          <div class="mb-6 md:mb-8">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800">My Tasks</h1>
            <p class="text-sm md:text-base text-slate-500">Your assigned tasks</p>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
            ${myTasks.length > 0 ? myTasks.map(task => {
              const mySubmission = appData.submissions.find(s => s.taskId === task.id && s.submittedBy === currentUser.id);
              return `
                <div class="bg-white rounded-xl p-4 md:p-6 border border-slate-200 card-hover">
                  <div class="flex items-start justify-between mb-3 gap-3">
                    <h3 class="font-bold text-slate-800 flex-1 text-sm md:text-base">${task.title}</h3>
                    ${mySubmission ? `
                      <span class="px-2 py-1 text-xs font-medium rounded whitespace-nowrap ${
                        mySubmission.grade ? 'bg-green-100 text-green-700' :
                        mySubmission.submissionStatus === 'approved' ? 'bg-green-100 text-green-700' :
                        'bg-blue-100 text-blue-700'
                      }">${mySubmission.grade || 'Submitted'}</span>
                    ` : ''}
                  </div>
                  <p class="text-slate-600 text-xs md:text-sm mb-4 line-clamp-2">${task.description}</p>
                  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2">
                    <span class="text-xs md:text-sm text-slate-500">Due: ${new Date(task.deadline).toLocaleDateString()}</span>
                    ${!mySubmission ? `
                      <button onclick="openSubmitTaskModal('${task.id}')" 
                        class="w-full sm:w-auto px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-xs md:text-sm">
                        Submit
                      </button>
                    ` : mySubmission.grade ? `
                      <span class="text-xs md:text-sm font-medium text-green-600">Grade: ${mySubmission.grade}</span>
                    ` : ''}
                  </div>
                </div>
              `;
            }).join('') : `
              <div class="col-span-full bg-white rounded-xl p-8 md:p-12 border border-slate-200 text-center text-slate-400">
                <p class="text-sm md:text-base">No tasks assigned yet</p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Submit Ticket Page
    function renderSubmitTicketPage() {
      const myTickets = appData.tickets.filter(t => t.raisedBy === currentUser.id);
      
      return `
        <div class="p-4 md:p-8">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 md:mb-8">
            <div>
              <h1 class="text-xl md:text-2xl font-bold text-slate-800">Support Center</h1>
              <p class="text-sm md:text-base text-slate-500">Get help from the team</p>
            </div>
            <button onclick="openModal('raiseTicket')" 
              class="w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
              ${icons.plus}
              <span>Raise Ticket</span>
            </button>
          </div>
          
          <div class="space-y-4">
            ${myTickets.length > 0 ? myTickets.map(ticket => `
              <div class="bg-white rounded-xl p-4 md:p-6 border border-slate-200">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <div class="flex flex-wrap items-center gap-2 md:gap-3 mb-2">
                      <h3 class="font-bold text-slate-800 text-sm md:text-base">${ticket.message}</h3>
                      <span class="px-2 py-1 text-xs font-medium rounded ${
                        ticket.ticketStatus === 'open' ? 'bg-orange-100 text-orange-700' :
                        'bg-green-100 text-green-700'
                      }">${ticket.ticketStatus}</span>
                    </div>
                    <p class="text-xs md:text-sm text-slate-500">Created: ${ticket.createdAt ? new Date(ticket.createdAt.seconds * 1000).toLocaleDateString() : 'Just now'}</p>
                  </div>
                </div>
              </div>
            `).join('') : `
              <div class="bg-white rounded-xl p-8 md:p-12 border border-slate-200 text-center text-slate-400">
                <p class="text-sm md:text-base">No tickets yet. Click "Raise Ticket" to get support.</p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Intern Space - Messaging Page
    function renderInternSpacePage() {
      const sortedMessages = [...appData.messages].sort((a, b) => {
        const timeA = a.createdAt ? (a.createdAt.seconds || 0) : 0;
        const timeB = b.createdAt ? (b.createdAt.seconds || 0) : 0;
        return timeA - timeB;
      });

      return `
        <div class="p-4 md:p-8 h-full flex flex-col">
          <div class="mb-6">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800">Intern Space ðŸ’¬</h1>
            <p class="text-sm md:text-base text-slate-500">Share thoughts and connect with the team</p>
          </div>
          
          <div class="flex-1 bg-white rounded-xl border border-slate-200 flex flex-col" style="max-height: calc(100vh - 220px);">
            <!-- Messages Container -->
            <div id="messagesContainer" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-3 messages-container scrollbar-thin">
              ${sortedMessages.length > 0 ? sortedMessages.map(msg => {
                const isSentByMe = msg.senderId === currentUser.id;
                const sender = appData.interns.find(i => i.id === msg.senderId) || { name: msg.senderName, photoUrl: '' };
                const timeStr = msg.createdAt ? new Date(msg.createdAt.seconds * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'Now';
                
                return `
                  <div class="flex ${isSentByMe ? 'justify-end' : 'justify-start'} items-end gap-2">
                    ${!isSentByMe ? `
                      <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                        ${getAvatar(sender.name, sender.photoUrl)}
                      </div>
                    ` : ''}
                    <div class="flex flex-col ${isSentByMe ? 'items-end' : 'items-start'} max-w-[75%]">
                      ${!isSentByMe ? `<p class="text-xs text-slate-500 mb-1 px-1">${sender.name}</p>` : ''}
                      <div class="message-bubble ${isSentByMe ? 'sent' : 'received'} px-4 py-2">
                        <p class="${isSentByMe ? 'text-white' : 'text-slate-800'} text-sm">${msg.message}</p>
                      </div>
                      <p class="text-xs text-slate-400 mt-1 px-1">${timeStr}</p>
                    </div>
                    ${isSentByMe ? `
                      <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                        ${getAvatar(currentUser.name, currentUser.photoUrl)}
                      </div>
                    ` : ''}
                  </div>
                `;
              }).join('') : `
                <div class="h-full flex items-center justify-center text-slate-400">
                  <div class="text-center">
                    <svg class="w-16 h-16 mx-auto mb-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    <p class="text-sm md:text-base">No messages yet</p>
                    <p class="text-xs md:text-sm mt-1">Be the first to share your thoughts!</p>
                  </div>
                </div>
              `}
            </div>
            
            <!-- Message Input -->
            <div class="border-t border-slate-200 p-4">
              <form id="sendMessageForm" class="flex gap-2">
                <input 
                  type="text" 
                  id="messageInput" 
                  placeholder="Type your message..." 
                  required
                  class="flex-1 px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 text-sm md:text-base"
                >
                <button 
                  type="submit" 
                  class="px-4 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center justify-center"
                  id="sendMessageBtn"
                >
                  ${icons.send}
                </button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    // Scroll messages to bottom
    function scrollMessagesToBottom() {
      const container = document.getElementById('messagesContainer');
      if (container) {
        container.scrollTop = container.scrollHeight;
      }
    }

    // Update attendance calendar without full page re-render
    function updateAttendanceCalendarOnly() {
      if (!currentAttendanceInternId) return;
      
      const attendanceStats = getAttendanceStats(currentAttendanceInternId);
      const year = currentCalendarDate.getFullYear();
      const month = currentCalendarDate.getMonth();
      const daysInMonth = getDaysInMonth(year, month);
      const todayStr = new Date().toISOString().split('T')[0];
      
      // Calculate monthly stats
      const monthlyStats = {
        present: 0,
        wfh: 0,
        absent: 0,
        leave: 0
      };
      
      // Calculate overall stats
      const overallStats = {
        present: attendanceStats.present,
        wfh: attendanceStats.wfh,
        absent: attendanceStats.absent,
        leave: attendanceStats.leave,
        total: attendanceStats.total
      };
      
      // Count monthly stats
      Object.entries(attendanceStats.byDate).forEach(([date, status]) => {
        const recordDate = new Date(date);
        if (recordDate.getFullYear() === year && recordDate.getMonth() === month) {
          if (status === 'present') monthlyStats.present++;
          else if (status === 'wfh') monthlyStats.wfh++;
          else if (status === 'absent') monthlyStats.absent++;
          else if (status === 'leave') monthlyStats.leave++;
        }
      });
      
      const monthlyTotal = monthlyStats.present + monthlyStats.wfh + monthlyStats.absent + monthlyStats.leave;
      
      // Update calendar day cells
      for (let i = 0; i < daysInMonth; i++) {
        const day = i + 1;
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const status = attendanceStats.byDate[dateStr] || '';
        const isToday = dateStr === todayStr;
        
        // Find the calendar day element
        const dayElements = document.querySelectorAll('[onclick*="toggleAttendance"]');
        dayElements.forEach(el => {
          if (el.getAttribute('onclick').includes(dateStr)) {
            // Update background and text classes
            el.className = el.className.split(' ').filter(c => 
              !c.includes('bg-') && !c.includes('text-') && !c.includes('ring-') && !c.includes('from-') && !c.includes('to-')
            ).join(' ');
            
            let bgClass = 'bg-white hover:bg-slate-50';
            let textClass = 'text-slate-700';
            let iconSvg = '';
            
            if (status === 'present') {
              bgClass = 'bg-gradient-to-br from-green-400 to-green-600';
              textClass = 'text-white font-bold';
              iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
            } else if (status === 'wfh') {
              bgClass = 'bg-gradient-to-br from-amber-400 to-amber-600';
              textClass = 'text-white font-bold';
              iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>';
            } else if (status === 'absent') {
              bgClass = 'bg-gradient-to-br from-red-400 to-red-600';
              textClass = 'text-white font-bold';
              iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
            } else if (status === 'leave') {
              bgClass = 'bg-gradient-to-br from-blue-400 to-blue-600';
              textClass = 'text-white font-bold';
              iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            }
            
            el.className += ' ' + bgClass;
            if (isToday) {
              el.className += ' ring-4 ring-blue-500 ring-inset';
            }
            
            // Update the cell content
            const dayNumber = el.querySelector('span');
            if (dayNumber) {
              dayNumber.className = textClass + ' text-lg font-semibold';
            }
            
            // Update icon
            const existingIcon = el.querySelector('svg');
            if (existingIcon) {
              existingIcon.remove();
            }
            if (iconSvg) {
              el.insertAdjacentHTML('afterbegin', iconSvg);
            }
          }
        });
      }
      
      // Update stats displays
      const updateStatElement = (selector, value) => {
        const el = document.querySelector(selector);
        if (el) el.textContent = value;
      };
      
      // Update monthly stats
      updateStatElement('[data-monthly-present]', monthlyStats.present);
      updateStatElement('[data-monthly-wfh]', monthlyStats.wfh);
      updateStatElement('[data-monthly-absent]', monthlyStats.absent);
      updateStatElement('[data-monthly-leave]', monthlyStats.leave);
      updateStatElement('[data-monthly-total]', monthlyTotal);
      
      // Update overall stats
      updateStatElement('[data-overall-present]', overallStats.present);
      updateStatElement('[data-overall-wfh]', overallStats.wfh);
      updateStatElement('[data-overall-absent]', overallStats.absent);
      updateStatElement('[data-overall-leave]', overallStats.leave);
      updateStatElement('[data-overall-total]', overallStats.total);
      
      // Update header quick stats
      updateStatElement('[data-header-present]', overallStats.present);
      updateStatElement('[data-header-wfh]', overallStats.wfh);
      updateStatElement('[data-header-absent]', overallStats.absent);
      updateStatElement('[data-header-leave]', overallStats.leave);
    }

    // Modals
    function renderModals() {
      let html = '';

      // Add Intern Modal
      if (modals.addIntern) {
        html += `
          <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
              <div class="sticky top-0 bg-white flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                <h3 class="text-base md:text-lg font-bold text-slate-800">Add New Intern</h3>
                <button onclick="closeModal('addIntern')" class="text-slate-400 hover:text-slate-600">
                  ${icons.x}
                </button>
              </div>
              <form id="addInternForm" class="p-4 md:p-6 space-y-4">
                <div>
                  <label for="internName" class="block text-sm font-medium text-slate-700 mb-2">Full Name</label>
                  <input type="text" id="internName" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="internEmail" class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                  <input type="email" id="internEmail" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="internPassword" class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                  <input type="text" id="internPassword" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="internRole" class="block text-sm font-medium text-slate-700 mb-2">Custom Role</label>
                  <input type="text" id="internRole" placeholder="e.g. Full Stack Developer" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="internPhoto" class="block text-sm font-medium text-slate-700 mb-2">Photo URL</label>
                  <input type="url" id="internPhoto" placeholder="Imgur or Cloudinary URL" 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                  <p class="text-xs text-slate-500 mt-1">ðŸ“¸ Upload to <a href="https://imgur.com/upload" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Imgur</a>, then paste the image URL</p>
                </div>
                <div class="flex gap-3 pt-4">
                  <button type="button" onclick="closeModal('addIntern')" 
                    class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                    Cancel
                  </button>
                  <button type="submit" id="addInternBtn"
                    class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                    Add Intern
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
      }

      // Edit Intern Modal
      if (modals.editIntern && editingIntern) {
        html += `
          <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
              <div class="sticky top-0 bg-white flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                <h3 class="text-base md:text-lg font-bold text-slate-800">Edit Intern Details</h3>
                <button onclick="closeModal('editIntern')" class="text-slate-400 hover:text-slate-600">
                  ${icons.x}
                </button>
              </div>
              <form id="editInternForm" class="p-4 md:p-6 space-y-4">
                <div>
                  <label for="editInternName" class="block text-sm font-medium text-slate-700 mb-2">Full Name</label>
                  <input type="text" id="editInternName" value="${editingIntern.name}" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="editInternEmail" class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                  <input type="email" id="editInternEmail" value="${editingIntern.email}" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="editInternPassword" class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                  <input type="text" id="editInternPassword" value="${editingIntern.password}" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="editInternRole" class="block text-sm font-medium text-slate-700 mb-2">Custom Role</label>
                  <input type="text" id="editInternRole" value="${editingIntern.role}" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="editInternPhoto" class="block text-sm font-medium text-slate-700 mb-2">Photo URL</label>
                  <input type="url" id="editInternPhoto" value="${editingIntern.photoUrl || ''}" 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div class="flex gap-3 pt-4">
                  <button type="button" onclick="closeModal('editIntern')" 
                    class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                    Cancel
                  </button>
                  <button type="submit" id="editInternBtn"
                    class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                    Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
      }

      // Add Task Modal
      if (modals.addTask) {
        html += `
          <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md">
              <div class="flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                <h3 class="text-base md:text-lg font-bold text-slate-800">Create Task</h3>
                <button onclick="closeModal('addTask')" class="text-slate-400 hover:text-slate-600">
                  ${icons.x}
                </button>
              </div>
              <form id="addTaskForm" class="p-4 md:p-6 space-y-4">
                <div>
                  <label for="taskTitle" class="block text-sm font-medium text-slate-700 mb-2">Task Title</label>
                  <input type="text" id="taskTitle" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="taskDescription" class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                  <textarea id="taskDescription" rows="3" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"></textarea>
                </div>
                <div>
                  <label for="taskDeadline" class="block text-sm font-medium text-slate-700 mb-2">Deadline</label>
                  <input type="date" id="taskDeadline" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="taskPriority" class="block text-sm font-medium text-slate-700 mb-2">Priority</label>
                  <select id="taskPriority" 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                  </select>
                </div>
                <div>
                  <label for="taskAssign" class="block text-sm font-medium text-slate-700 mb-2">Assign To</label>
                  <select id="taskAssign" 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                    <option value="all">All Interns</option>
                    ${appData.interns.map(i => `<option value="${i.id}">${i.name}</option>`).join('')}
                  </select>
                </div>
                <div class="flex gap-3 pt-4">
                  <button type="button" onclick="closeModal('addTask')" 
                    class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                    Cancel
                  </button>
                  <button type="submit" id="addTaskBtn"
                    class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                    Create
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
      }

      // Add Project Modal
      if (modals.addProject) {
        html += `
          <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md">
              <div class="flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                <h3 class="text-base md:text-lg font-bold text-slate-800">Add Project</h3>
                <button onclick="closeModal('addProject')" class="text-slate-400 hover:text-slate-600">
                  ${icons.x}
                </button>
              </div>
              <form id="addProjectForm" class="p-4 md:p-6 space-y-4">
                <div>
                  <label for="projectTitle" class="block text-sm font-medium text-slate-700 mb-2">Project Title</label>
                  <input type="text" id="projectTitle" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="projectDescription" class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                  <textarea id="projectDescription" rows="3" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"></textarea>
                </div>
                <div>
                  <label for="projectTech" class="block text-sm font-medium text-slate-700 mb-2">Technologies (comma separated)</label>
                  <input type="text" id="projectTech" placeholder="React, Node.js, MongoDB" 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="projectStatus" class="block text-sm font-medium text-slate-700 mb-2">Status</label>
                  <select id="projectStatus" 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                    <option value="planning">Planning</option>
                    <option value="in-progress">In Progress</option>
                    <option value="completed">Completed</option>
                  </select>
                </div>
                <div class="flex gap-3 pt-4">
                  <button type="button" onclick="closeModal('addProject')" 
                    class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                    Cancel
                  </button>
                  <button type="submit" id="addProjectBtn"
                    class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                    Add
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
      }

      // Add Team Modal
      if (modals.addTeam) {
        html += `
          <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
              <div class="sticky top-0 bg-white flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                <h3 class="text-base md:text-lg font-bold text-slate-800">Create Team</h3>
                <button onclick="closeModal('addTeam')" class="text-slate-400 hover:text-slate-600">
                  ${icons.x}
                </button>
              </div>
              <form id="addTeamForm" class="p-4 md:p-6 space-y-4">
                <div>
                  <label for="teamName" class="block text-sm font-medium text-slate-700 mb-2">Team Name</label>
                  <input type="text" id="teamName" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="teamDescription" class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                  <textarea id="teamDescription" rows="2" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"></textarea>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2">Select Members</label>
                  <div class="max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-3 space-y-2">
                    ${appData.interns.map(intern => `
                      <label class="flex items-center gap-2 cursor-pointer hover:bg-slate-50 p-2 rounded">
                        <input type="checkbox" value="${intern.id}" class="team-member-checkbox w-4 h-4">
                        <span class="text-sm text-slate-700">${intern.name}</span>
                      </label>
                    `).join('')}
                  </div>
                </div>
                <div class="flex gap-3 pt-4">
                  <button type="button" onclick="closeModal('addTeam')" 
                    class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                    Cancel
                  </button>
                  <button type="submit" id="addTeamBtn"
                    class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                    Create
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
      }

      // Edit Team Modal
      if (modals.editTeam && editingIntern) {
        const team = editingIntern;
        const currentMembers = team.members ? team.members.split(',') : [];
        
        html += `
          <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
              <div class="sticky top-0 bg-white flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                <h3 class="text-base md:text-lg font-bold text-slate-800">Edit Team</h3>
                <button onclick="closeModal('editTeam')" class="text-slate-400 hover:text-slate-600">
                  ${icons.x}
                </button>
              </div>
              <form id="editTeamForm" class="p-4 md:p-6 space-y-4">
                <div>
                  <label for="editTeamName" class="block text-sm font-medium text-slate-700 mb-2">Team Name</label>
                  <input type="text" id="editTeamName" value="${team.teamName}" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                </div>
                <div>
                  <label for="editTeamDescription" class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                  <textarea id="editTeamDescription" rows="2" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">${team.teamDescription}</textarea>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-2">Select Members</label>
                  <div class="max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-3 space-y-2">
                    ${appData.interns.map(intern => `
                      <label class="flex items-center gap-2 cursor-pointer hover:bg-slate-50 p-2 rounded">
                        <input type="checkbox" value="${intern.id}" class="edit-team-member-checkbox w-4 h-4" ${currentMembers.includes(intern.id) ? 'checked' : ''}>
                        <span class="text-sm text-slate-700">${intern.name}</span>
                      </label>
                    `).join('')}
                  </div>
                </div>
                <div class="flex gap-3 pt-4">
                  <button type="button" onclick="closeModal('editTeam')" 
                    class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                    Cancel
                  </button>
                  <button type="submit" id="editTeamBtn"
                    class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                    Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
      }

      // Attendance Modal
      if (modals.attendance) {
        const intern = appData.interns.find(i => i.id === selectedInternId);
        if (intern) {
          const year = currentCalendarDate.getFullYear();
          const month = currentCalendarDate.getMonth();
          const daysInMonth = getDaysInMonth(year, month);
          const firstDay = getFirstDayOfMonth(year, month);
          const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
          const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          
          const attendanceStats = getAttendanceStats(intern.id);
          
          // Calculate monthly stats
          const monthlyStats = {
            present: 0,
            wfh: 0,
            absent: 0,
            leave: 0
          };
          
          // Calculate overall stats
          const overallStats = {
            present: attendanceStats.present,
            wfh: attendanceStats.wfh,
            absent: attendanceStats.absent,
            leave: attendanceStats.leave,
            total: attendanceStats.total
          };
          
          // Count monthly stats
          Object.entries(attendanceStats.byDate).forEach(([date, status]) => {
            const recordDate = new Date(date);
            if (recordDate.getFullYear() === year && recordDate.getMonth() === month) {
              if (status === 'present') monthlyStats.present++;
              else if (status === 'wfh') monthlyStats.wfh++;
              else if (status === 'absent') monthlyStats.absent++;
              else if (status === 'leave') monthlyStats.leave++;
            }
          });
          
          const monthlyTotal = monthlyStats.present + monthlyStats.wfh + monthlyStats.absent + monthlyStats.leave;
          const today = new Date();
          const todayStr = today.toISOString().split('T')[0];
          
          html += `
            <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-[100] p-4">
              <div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col">
                <!-- Header -->
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-4">
                      <div class="w-14 h-14 rounded-full overflow-hidden border-3 border-white shadow-lg">
                        ${getAvatar(intern.name, intern.photoUrl)}
                      </div>
                      <div>
                        <h3 class="text-xl font-bold">${intern.name}</h3>
                        <p class="text-blue-100 text-sm">${intern.role || 'Intern'}</p>
                      </div>
                    </div>
                    <button onclick="closeModal('attendance')" 
                      class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 transition-all flex items-center justify-center backdrop-blur-sm">
                      ${icons.x}
                    </button>
                  </div>
                  
                  <!-- Quick Stats Bar -->
                  <div class="grid grid-cols-4 gap-3 mt-4">
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold" data-header-present>${overallStats.present}</div>
                      <div class="text-xs text-blue-100">Total Present</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold" data-header-wfh>${overallStats.wfh}</div>
                      <div class="text-xs text-blue-100">Total WFH</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold" data-header-absent>${overallStats.absent}</div>
                      <div class="text-xs text-blue-100">Total Absent</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold" data-header-leave>${overallStats.leave}</div>
                      <div class="text-xs text-blue-100">Total Leave</div>
                    </div>
                  </div>
                </div>
                
                <!-- Content -->
                <div class="flex-1 overflow-y-auto p-6">
                  <!-- Month Navigation -->
                  <div class="flex items-center justify-between mb-6">
                    <button onclick="changeCalendarMonth(-1)" 
                      class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                      </svg>
                      <span class="text-sm font-medium">Previous</span>
                    </button>
                    
                    <div class="text-center">
                      <h4 class="text-2xl font-bold text-slate-800">${monthNames[month]} ${year}</h4>
                      <p class="text-sm text-slate-500 mt-1">Click to mark attendance</p>
                    </div>
                    
                    <button onclick="changeCalendarMonth(1)" 
                      class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg">
                      <span class="text-sm font-medium">Next</span>
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                      </svg>
                    </button>
                  </div>
                  
                  <!-- Legend -->
                  <div class="flex flex-wrap items-center justify-center gap-4 mb-6 p-4 bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl border border-slate-200">
                    <div class="flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-green-600 rounded-lg shadow-md flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                      </div>
                      <span class="text-sm font-semibold text-slate-700">Present</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-amber-400 to-amber-600 rounded-lg shadow-md flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                      </div>
                      <span class="text-sm font-semibold text-slate-700">WFH</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-red-400 to-red-600 rounded-lg shadow-md flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                      </div>
                      <span class="text-sm font-semibold text-slate-700">Absent</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg shadow-md flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                      </div>
                      <span class="text-sm font-semibold text-slate-700">Leave</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-8 h-8 bg-slate-100 border-2 border-slate-300 rounded-lg"></div>
                      <span class="text-sm font-semibold text-slate-700">Not Marked</span>
                    </div>
                  </div>
                  
                  <!-- Calendar Grid -->
                  <div class="bg-white rounded-2xl border-2 border-slate-200 overflow-hidden shadow-sm">
                    <!-- Day Headers -->
                    <div class="grid grid-cols-7 bg-gradient-to-r from-slate-100 to-blue-50 border-b-2 border-slate-200">
                      ${dayNames.map(day => `
                        <div class="text-center font-bold text-slate-700 py-3 text-sm">${day}</div>
                      `).join('')}
                    </div>
                    
                    <!-- Calendar Days -->
                    <div class="grid grid-cols-7 gap-0">
                      ${Array(firstDay).fill(0).map(() => `
                        <div class="aspect-square border border-slate-100 bg-slate-50"></div>
                      `).join('')}
                      ${Array(daysInMonth).fill(0).map((_, i) => {
                        const day = i + 1;
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const status = attendanceStats.byDate[dateStr] || '';
                        const isToday = dateStr === todayStr;
                        
                        let bgClass = 'bg-white hover:bg-slate-50';
                        let textClass = 'text-slate-700';
                        let iconSvg = '';
                        
                        if (status === 'present') {
                          bgClass = 'bg-gradient-to-br from-green-400 to-green-600';
                          textClass = 'text-white font-bold';
                          iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                        } else if (status === 'wfh') {
                          bgClass = 'bg-gradient-to-br from-amber-400 to-amber-600';
                          textClass = 'text-white font-bold';
                          iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>';
                        } else if (status === 'absent') {
                          bgClass = 'bg-gradient-to-br from-red-400 to-red-600';
                          textClass = 'text-white font-bold';
                          iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
                        } else if (status === 'leave') {
                          bgClass = 'bg-gradient-to-br from-blue-400 to-blue-600';
                          textClass = 'text-white font-bold';
                          iconSvg = '<svg class="w-4 h-4 text-white absolute top-1 right-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                        }
                        
                        return `
                          <div class="aspect-square border border-slate-100 ${bgClass} ${isToday ? 'ring-4 ring-blue-500 ring-inset' : ''} 
                                      cursor-pointer transition-all hover:scale-95 hover:shadow-lg relative flex items-center justify-center group" 
                               onclick="toggleAttendance('${dateStr}')"
                               title="${dateStr}">
                            ${iconSvg}
                            <span class="${textClass} text-lg font-semibold">${day}</span>
                            ${isToday ? '<div class="absolute bottom-1 left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-blue-500 rounded-full"></div>' : ''}
                          </div>
                        `;
                      }).join('')}
                    </div>
                  </div>
                  
                  <!-- Monthly Summary -->
                  <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Monthly Stats -->
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-5 border-2 border-blue-200 shadow-md">
                      <div class="flex items-center gap-2 mb-4">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h5 class="font-bold text-slate-800 text-lg">This Month</h5>
                      </div>
                      <div class="space-y-3">
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                            Present
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-monthly-present>${monthlyStats.present}</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                            WFH
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-monthly-wfh>${monthlyStats.wfh}</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                            Absent
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-monthly-absent>${monthlyStats.absent}</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                            Leave
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-monthly-leave>${monthlyStats.leave}</span>
                        </div>
                        <div class="pt-3 border-t-2 border-blue-200">
                          <div class="flex items-center justify-between">
                            <span class="text-slate-700 font-semibold">Total Marked</span>
                            <span class="text-blue-600 font-bold text-xl" data-monthly-total>${monthlyTotal}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Overall Stats -->
                    <div class="bg-gradient-to-br from-green-50 to-teal-50 rounded-2xl p-5 border-2 border-green-200 shadow-md">
                      <div class="flex items-center gap-2 mb-4">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <h5 class="font-bold text-slate-800 text-lg">All Time</h5>
                      </div>
                      <div class="space-y-3">
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                            Present
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-overall-present>${overallStats.present}</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                            WFH
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-overall-wfh>${overallStats.wfh}</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                            Absent
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-overall-absent>${overallStats.absent}</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span class="text-slate-600 text-sm flex items-center gap-2">
                            <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                            Leave
                          </span>
                          <span class="text-slate-800 font-bold text-lg" data-overall-leave>${overallStats.leave}</span>
                        </div>
                        <div class="pt-3 border-t-2 border-green-200">
                          <div class="flex items-center justify-between">
                            <span class="text-slate-700 font-semibold">Total Days</span>
                            <span class="text-green-600 font-bold text-xl" data-overall-total>${overallStats.total}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Footer -->
                <div class="p-4 border-t border-slate-200 bg-slate-50">
                  <button onclick="closeModal('attendance')" 
                    class="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl font-semibold text-base">
                    Done
                  </button>
                </div>
              </div>
            </div>
          `;
        }
      }

      // Submit Task Modal
      if (modals.submitTask) {
        const task = appData.tasks.find(t => t.id === selectedInternId);
        if (task) {
          html += `
            <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
              <div class="bg-white rounded-2xl shadow-xl w-full max-w-md">
                <div class="flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                  <h3 class="text-base md:text-lg font-bold text-slate-800">Submit Task</h3>
                  <button onclick="closeModal('submitTask')" class="text-slate-400 hover:text-slate-600">
                    ${icons.x}
                  </button>
                </div>
                <form id="submitTaskForm" class="p-4 md:p-6 space-y-4">
                  <div>
                    <p class="text-sm font-medium text-slate-700 mb-2">Task: ${task.title}</p>
                  </div>
                  <div>
                    <label for="submissionText" class="block text-sm font-medium text-slate-700 mb-2">Submission Details</label>
                    <textarea id="submissionText" rows="4" required 
                      class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"></textarea>
                  </div>
                  <div>
                    <label for="submissionUrl" class="block text-sm font-medium text-slate-700 mb-2">URL (Optional)</label>
                    <input type="url" id="submissionUrl" placeholder="https://github.com/..." 
                      class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                  </div>
                  <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeModal('submitTask')" 
                      class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                      Cancel
                    </button>
                    <button type="submit" id="submitTaskBtn"
                      class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                      Submit
                    </button>
                  </div>
                </form>
              </div>
            </div>
          `;
        }
      }

      // Raise Ticket Modal
      if (modals.raiseTicket) {
        html += `
          <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md">
              <div class="flex items-center justify-between p-4 md:p-6 border-b border-slate-200">
                <h3 class="text-base md:text-lg font-bold text-slate-800">Raise Support Ticket</h3>
                <button onclick="closeModal('raiseTicket')" class="text-slate-400 hover:text-slate-600">
                  ${icons.x}
                </button>
              </div>
              <form id="raiseTicketForm" class="p-4 md:p-6 space-y-4">
                <div>
                  <label for="ticketMessage" class="block text-sm font-medium text-slate-700 mb-2">Issue Description</label>
                  <textarea id="ticketMessage" rows="4" required 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"></textarea>
                </div>
                <div>
                  <label for="ticketPriority" class="block text-sm font-medium text-slate-700 mb-2">Priority</label>
                  <select id="ticketPriority" 
                    class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                  </select>
                </div>
                <div class="flex gap-3 pt-4">
                  <button type="button" onclick="closeModal('raiseTicket')" 
                    class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                    Cancel
                  </button>
                  <button type="submit" id="raiseTicketBtn"
                    class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">
                    Submit
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
      }

      // Team Hub Modal
      if (modals.teamHub && selectedTeamId) {
        const team = appData.teams.find(t => t.id === selectedTeamId);
        if (team) {
          const memberIds = team.members ? team.members.split(',') : [];
          const members = appData.interns.filter(i => memberIds.includes(i.id));
          const teamTasks = appData.tasks.filter(t => t.teamId === team.id);
          const isAdmin = currentUser.role === 'admin';
          const isMember = memberIds.includes(currentUser.id) || isAdmin;
          
          // Get team messages
          const teamMessages = appData.teamMessages.filter(m => m.teamId === team.id).sort((a, b) => {
            const timeA = a.createdAt ? (a.createdAt.seconds || 0) : 0;
            const timeB = b.createdAt ? (b.createdAt.seconds || 0) : 0;
            return timeA - timeB;
          });
          
          // Get team meetings
          const teamMeetings = appData.meetings.filter(m => m.teamId === team.id).sort((a, b) => {
            return new Date(b.meetingDate) - new Date(a.meetingDate);
          });
          
          // Calculate team stats
          const completedTasks = teamTasks.filter(t => t.taskStatus === 'completed').length;
          const totalSubmissions = appData.submissions.filter(s => 
            teamTasks.some(t => t.id === s.taskId)
          ).length;
          
          html += `
            <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-[200] p-4">
              <div class="bg-white rounded-3xl shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col">
                <!-- Team Hub Header -->
                <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 p-6 text-white relative overflow-hidden">
                  <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32"></div>
                  <div class="absolute bottom-0 left-0 w-48 h-48 bg-white/10 rounded-full -ml-24 -mb-24"></div>
                  
                  <div class="relative flex items-center justify-between">
                    <div class="flex items-center gap-4">
                      <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                      </div>
                      <div>
                        <h2 class="text-3xl font-bold mb-1">${team.teamName}</h2>
                        <p class="text-blue-100">${team.teamDescription}</p>
                      </div>
                    </div>
                    <button onclick="closeModal('teamHub')" 
                      class="w-12 h-12 rounded-full bg-white/20 hover:bg-white/30 transition-all flex items-center justify-center backdrop-blur-sm">
                      ${icons.x}
                    </button>
                  </div>
                  
                  <!-- Quick Stats -->
                  <div class="grid grid-cols-4 gap-3 mt-6">
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold">${members.length}</div>
                      <div class="text-xs text-blue-100">Members</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold">${teamTasks.length}</div>
                      <div class="text-xs text-blue-100">Tasks</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold">${completedTasks}</div>
                      <div class="text-xs text-blue-100">Completed</div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center">
                      <div class="text-2xl font-bold">${teamMessages.length}</div>
                      <div class="text-xs text-blue-100">Messages</div>
                    </div>
                  </div>
                </div>
                
                <!-- Tabs Navigation -->
                <div class="border-b border-slate-200 bg-white px-6">
                  <div class="flex gap-1 overflow-x-auto scrollbar-thin">
                    <button onclick="switchTeamTab('overview')" id="teamTab-overview"
                      class="team-tab px-4 py-3 font-semibold text-sm border-b-2 border-blue-600 text-blue-600">
                      ðŸ“Š Overview
                    </button>
                    <button onclick="switchTeamTab('chat')" id="teamTab-chat"
                      class="team-tab px-4 py-3 font-semibold text-sm border-b-2 border-transparent text-slate-600 hover:text-slate-900">
                      ðŸ’¬ Team Chat
                    </button>
                    <button onclick="switchTeamTab('tasks')" id="teamTab-tasks"
                      class="team-tab px-4 py-3 font-semibold text-sm border-b-2 border-transparent text-slate-600 hover:text-slate-900">
                      ðŸ“‹ Tasks
                    </button>
                    <button onclick="switchTeamTab('members')" id="teamTab-members"
                      class="team-tab px-4 py-3 font-semibold text-sm border-b-2 border-transparent text-slate-600 hover:text-slate-900">
                      ðŸ‘¥ Members
                    </button>
                    <button onclick="switchTeamTab('meetings')" id="teamTab-meetings"
                      class="team-tab px-4 py-3 font-semibold text-sm border-b-2 border-transparent text-slate-600 hover:text-slate-900">
                      ðŸ“… Meetings
                    </button>
                    <button onclick="switchTeamTab('files')" id="teamTab-files"
                      class="team-tab px-4 py-3 font-semibold text-sm border-b-2 border-transparent text-slate-600 hover:text-slate-900">
                      ðŸ“ Resources
                    </button>
                  </div>
                </div>
                
                <!-- Tab Content -->
                <div class="flex-1 overflow-y-auto p-6 scrollbar-thin">
                  <!-- Overview Tab -->
                  <div id="teamContent-overview" class="team-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                      <!-- Team Members Card -->
                      <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-200">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                          </svg>
                          Team Members (${members.length})
                        </h3>
                        <div class="space-y-3">
                          ${members.slice(0, 5).map(m => `
                            <div class="flex items-center gap-3 p-3 bg-white rounded-xl hover:shadow-md transition-all">
                              <div class="w-12 h-12 rounded-full overflow-hidden ring-2 ring-blue-200">
                                ${getAvatar(m.name, m.photoUrl)}
                              </div>
                              <div class="flex-1">
                                <p class="font-semibold text-slate-800">${m.name}</p>
                                <p class="text-xs text-slate-500">${m.role || 'Intern'}</p>
                              </div>
                              <div class="w-3 h-3 bg-green-500 rounded-full" title="Online"></div>
                            </div>
                          `).join('')}
                          ${members.length > 5 ? `
                            <button onclick="switchTeamTab('members')" class="w-full py-2 text-blue-600 hover:text-blue-700 font-medium text-sm">
                              View all ${members.length} members â†’
                            </button>
                          ` : ''}
                        </div>
                      </div>
                      
                      <!-- Task Progress Card -->
                      <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-200">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                          <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                          </svg>
                          Task Progress
                        </h3>
                        <div class="space-y-4">
                          <div>
                            <div class="flex items-center justify-between mb-2">
                              <span class="text-sm font-medium text-slate-700">Completion Rate</span>
                              <span class="text-2xl font-bold text-purple-600">${teamTasks.length > 0 ? Math.round((completedTasks / teamTasks.length) * 100) : 0}%</span>
                            </div>
                            <div class="w-full bg-slate-200 rounded-full h-3 overflow-hidden">
                              <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-full rounded-full transition-all duration-500" 
                                   style="width: ${teamTasks.length > 0 ? (completedTasks / teamTasks.length) * 100 : 0}%"></div>
                            </div>
                          </div>
                          
                          <div class="grid grid-cols-2 gap-3 mt-4">
                            <div class="bg-white rounded-xl p-4 text-center">
                              <div class="text-3xl font-bold text-green-600">${completedTasks}</div>
                              <div class="text-xs text-slate-600 mt-1">Completed</div>
                            </div>
                            <div class="bg-white rounded-xl p-4 text-center">
                              <div class="text-3xl font-bold text-orange-600">${teamTasks.length - completedTasks}</div>
                              <div class="text-xs text-slate-600 mt-1">In Progress</div>
                            </div>
                          </div>
                          
                          <button onclick="switchTeamTab('tasks')" class="w-full mt-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 font-medium text-sm">
                            View All Tasks â†’
                          </button>
                        </div>
                      </div>
                      
                      <!-- Recent Activity -->
                      <div class="lg:col-span-2 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border-2 border-green-200">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                          <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                          </svg>
                          Recent Team Activity
                        </h3>
                        <div class="space-y-3">
                          ${teamMessages.slice(-5).reverse().map(msg => {
                            const sender = appData.interns.find(i => i.id === msg.senderId) || { name: msg.senderName };
                            const timeStr = msg.createdAt ? new Date(msg.createdAt.seconds * 1000).toLocaleString() : 'Just now';
                            return `
                              <div class="flex items-start gap-3 p-3 bg-white rounded-xl">
                                <div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0">
                                  ${getAvatar(sender.name, sender.photoUrl)}
                                </div>
                                <div class="flex-1 min-w-0">
                                  <div class="flex items-center gap-2 mb-1">
                                    <span class="font-semibold text-slate-800 text-sm">${sender.name}</span>
                                    <span class="text-xs text-slate-400">${timeStr}</span>
                                  </div>
                                  <p class="text-sm text-slate-600 line-clamp-2">${msg.message}</p>
                                </div>
                              </div>
                            `;
                          }).join('')}
                          ${teamMessages.length === 0 ? `
                            <div class="text-center py-8 text-slate-400">
                              <p class="text-sm">No activity yet. Start a conversation!</p>
                            </div>
                          ` : ''}
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Chat Tab -->
                  <div id="teamContent-chat" class="team-content hidden">
                    <div class="bg-white rounded-2xl border-2 border-slate-200 h-[600px] flex flex-col">
                      <div class="flex-1 overflow-y-auto p-6 space-y-3 scrollbar-thin" id="teamMessagesContainer">
                        ${teamMessages.length > 0 ? teamMessages.map(msg => {
                          const isSentByMe = msg.senderId === currentUser.id;
                          const sender = appData.interns.find(i => i.id === msg.senderId) || { name: msg.senderName, photoUrl: '' };
                          const timeStr = msg.createdAt ? new Date(msg.createdAt.seconds * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'Now';
                          
                          return `
                            <div class="flex ${isSentByMe ? 'justify-end' : 'justify-start'} items-end gap-2">
                              ${!isSentByMe ? `
                                <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                                  ${getAvatar(sender.name, sender.photoUrl)}
                                </div>
                              ` : ''}
                              <div class="flex flex-col ${isSentByMe ? 'items-end' : 'items-start'} max-w-[75%]">
                                ${!isSentByMe ? `<p class="text-xs text-slate-500 mb-1 px-1">${sender.name}</p>` : ''}
                                <div class="message-bubble ${isSentByMe ? 'sent' : 'received'} px-4 py-2">
                                  <p class="${isSentByMe ? 'text-white' : 'text-slate-800'} text-sm">${msg.message}</p>
                                </div>
                                <p class="text-xs text-slate-400 mt-1 px-1">${timeStr}</p>
                              </div>
                              ${isSentByMe ? `
                                <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                                  ${getAvatar(currentUser.name, currentUser.photoUrl)}
                                </div>
                              ` : ''}
                            </div>
                          `;
                        }).join('') : `
                          <div class="h-full flex items-center justify-center text-slate-400">
                            <div class="text-center">
                              <svg class="w-16 h-16 mx-auto mb-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                              </svg>
                              <p>No team messages yet</p>
                              <p class="text-sm mt-1">Start the conversation!</p>
                            </div>
                          </div>
                        `}
                      </div>
                      
                      ${isMember ? `
                        <div class="border-t border-slate-200 p-4">
                          <form id="sendTeamMessageForm" class="flex gap-2">
                            <input type="text" id="teamMessageInput" placeholder="Type your message..." required
                              class="flex-1 px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500">
                            <button type="submit" id="sendTeamMessageBtn"
                              class="px-4 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors">
                              ${icons.send}
                            </button>
                          </form>
                        </div>
                      ` : ''}
                    </div>
                  </div>
                  
                  <!-- Tasks Tab -->
                  <div id="teamContent-tasks" class="team-content hidden">
                    ${isAdmin ? `
                      <div class="mb-6">
                        <button onclick="openCreateTeamTaskModal('${team.id}')" 
                          class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                          ${icons.plus}
                          <span>Create Team Task</span>
                        </button>
                      </div>
                    ` : ''}
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                      ${teamTasks.length > 0 ? teamTasks.map(task => {
                        const submissions = appData.submissions.filter(s => s.taskId === task.id);
                        return `
                          <div class="bg-white rounded-xl p-5 border-2 border-slate-200 hover:border-blue-300 transition-all">
                            <div class="flex items-start justify-between mb-3">
                              <h4 class="font-bold text-slate-800 flex-1">${task.title}</h4>
                              <span class="px-2 py-1 text-xs font-medium rounded ${
                                task.priority === 'high' ? 'bg-red-100 text-red-700' :
                                task.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                                'bg-green-100 text-green-700'
                              }">${task.priority || 'low'}</span>
                            </div>
                            <p class="text-sm text-slate-600 mb-4 line-clamp-2">${task.description}</p>
                            <div class="flex items-center justify-between text-sm">
                              <span class="text-slate-500">Due: ${new Date(task.deadline).toLocaleDateString()}</span>
                              <span class="text-blue-600 font-medium">${submissions.length} submissions</span>
                            </div>
                          </div>
                        `;
                      }).join('') : `
                        <div class="lg:col-span-2 text-center py-12 text-slate-400">
                          <svg class="w-16 h-16 mx-auto mb-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                          </svg>
                          <p>No team tasks yet</p>
                        </div>
                      `}
                    </div>
                  </div>
                  
                  <!-- Members Tab -->
                  <div id="teamContent-members" class="team-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      ${members.map(m => {
                        const memberTasks = teamTasks.filter(t => t.assignedTo === m.id);
                        const memberSubmissions = appData.submissions.filter(s => s.submittedBy === m.id);
                        return `
                          <div class="bg-gradient-to-br from-white to-blue-50 rounded-xl p-5 border-2 border-blue-200 hover:shadow-lg transition-all">
                            <div class="flex items-center gap-4 mb-4">
                              <div class="w-16 h-16 rounded-full overflow-hidden ring-2 ring-blue-300">
                                ${getAvatar(m.name, m.photoUrl)}
                              </div>
                              <div class="flex-1">
                                <h4 class="font-bold text-slate-800">${m.name}</h4>
                                <p class="text-sm text-slate-500">${m.role || 'Intern'}</p>
                              </div>
                              <div class="w-3 h-3 bg-green-500 rounded-full" title="Active"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                              <div class="bg-white rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-blue-600">${memberTasks.length}</div>
                                <div class="text-xs text-slate-600">Tasks</div>
                              </div>
                              <div class="bg-white rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-green-600">${memberSubmissions.length}</div>
                                <div class="text-xs text-slate-600">Submitted</div>
                              </div>
                            </div>
                          </div>
                        `;
                      }).join('')}
                    </div>
                  </div>
                  
                  <!-- Meetings Tab -->
                  <div id="teamContent-meetings" class="team-content hidden">
                    ${isAdmin ? `
                      <div class="mb-6">
                        <button onclick="openScheduleMeetingModal('${team.id}')" 
                          class="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                          ${icons.plus}
                          <span>Schedule Meeting</span>
                        </button>
                      </div>
                    ` : ''}
                    
                    <div class="space-y-4">
                      ${teamMeetings.length > 0 ? teamMeetings.map(meeting => {
                        const meetingDate = new Date(meeting.meetingDate);
                        const isPast = meetingDate < new Date();
                        return `
                          <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-5 border-2 border-purple-200">
                            <div class="flex items-start justify-between mb-3">
                              <div class="flex-1">
                                <h4 class="font-bold text-slate-800 text-lg mb-2">${meeting.meetingTitle}</h4>
                                <p class="text-sm text-slate-600 mb-3">${meeting.meetingDescription || 'No description'}</p>
                                <div class="flex flex-wrap gap-3 text-sm">
                                  <span class="flex items-center gap-2 text-slate-600">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    ${meetingDate.toLocaleDateString()}
                                  </span>
                                  <span class="flex items-center gap-2 text-slate-600">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    ${meeting.meetingTime || 'Time TBD'}
                                  </span>
                                </div>
                              </div>
                              <span class="px-3 py-1 text-xs font-medium rounded ${
                                isPast ? 'bg-slate-100 text-slate-600' : 'bg-green-100 text-green-700'
                              }">
                                ${isPast ? 'Past' : 'Upcoming'}
                              </span>
                            </div>
                            ${meeting.meetingLink ? `
                              <a href="${meeting.meetingLink}" target="_blank" rel="noopener noreferrer"
                                class="inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm font-medium">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                                Join Meeting
                              </a>
                            ` : ''}
                          </div>
                        `;
                      }).join('') : `
                        <div class="text-center py-12 text-slate-400">
                          <svg class="w-16 h-16 mx-auto mb-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                          </svg>
                          <p>No meetings scheduled yet</p>
                        </div>
                      `}
                    </div>
                  </div>
                  
                  <!-- Files/Resources Tab -->
                  <div id="teamContent-files" class="team-content hidden">
                    ${isAdmin ? `
                      <div class="mb-6">
                        <button onclick="openAddResourceModal('${team.id}')" 
                          class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                          ${icons.plus}
                          <span>Add Resource</span>
                        </button>
                      </div>
                    ` : ''}
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200 hover:shadow-lg transition-all cursor-pointer">
                        <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center mb-4">
                          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                          </svg>
                        </div>
                        <h4 class="font-bold text-slate-800 mb-2">Project Guidelines</h4>
                        <p class="text-sm text-slate-600">Team documentation and guidelines</p>
                      </div>
                      
                      <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border-2 border-purple-200 hover:shadow-lg transition-all cursor-pointer">
                        <div class="w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center mb-4">
                          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                          </svg>
                        </div>
                        <h4 class="font-bold text-slate-800 mb-2">Code Repository</h4>
                        <p class="text-sm text-slate-600">GitHub repository and resources</p>
                      </div>
                      
                      <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border-2 border-green-200 hover:shadow-lg transition-all cursor-pointer">
                        <div class="w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center mb-4">
                          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                          </svg>
                        </div>
                        <h4 class="font-bold text-slate-800 mb-2">Learning Resources</h4>
                        <p class="text-sm text-slate-600">Tutorials and learning materials</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
      }

      // Delete Confirmation
      if (confirmDelete) {
        const isTeam = confirmDelete.startsWith('team_');
        
        if (isTeam) {
          const teamId = confirmDelete.replace('team_', '');
          const team = appData.teams.find(t => t.id === teamId);
          if (team) {
            html += `
              <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-4 md:p-6">
                  <h3 class="text-base md:text-lg font-bold text-slate-800 mb-4">Confirm Delete Team</h3>
                  <p class="text-sm md:text-base text-slate-600 mb-6">Are you sure you want to delete the team <strong>"${team.teamName}"</strong>? This action cannot be undone.</p>
                  <div class="flex gap-3">
                    <button onclick="cancelDelete()" 
                      class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                      Cancel
                    </button>
                    <button onclick="deleteTeam('${teamId}')" 
                      class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm md:text-base">
                      Delete Team
                    </button>
                  </div>
                </div>
              </div>
            `;
          }
        } else {
          const intern = appData.interns.find(i => i.id === confirmDelete);
          if (intern) {
            html += `
              <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-4 md:p-6">
                  <h3 class="text-base md:text-lg font-bold text-slate-800 mb-4">Confirm Delete</h3>
                  <p class="text-sm md:text-base text-slate-600 mb-6">Are you sure you want to delete <strong>${intern.name}</strong>? This action cannot be undone.</p>
                  <div class="flex gap-3">
                    <button onclick="cancelDelete()" 
                      class="flex-1 px-4 py-3 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm md:text-base">
                      Cancel
                    </button>
                    <button onclick="deleteIntern('${confirmDelete}')" 
                      class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm md:text-base">
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            `;
          }
        }
      }

      return html;
    }

    // Main render
    function render() {
      const app = document.getElementById('app');
      
      if (!currentUser) {
        app.innerHTML = renderLoginPage();
        attachLoginHandler();
      } else {
        const isAdmin = currentUser.role === 'admin';
        let content = '';
        
        if (isAdmin) {
          switch (currentPage) {
            case 'dashboard': content = renderAdminDashboard(); break;
            case 'interns': content = renderInternsPage(); break;
            case 'tasks': content = renderTasksPage(); break;
            case 'projects': content = renderProjectsPage(); break;
            case 'teams': content = renderTeamsPage(); break;
            case 'attendance': content = renderAttendancePage(); break;
            case 'tickets': content = renderTicketsPage(); break;
            case 'intern-space': content = renderInternSpacePage(); break;
            default: content = renderAdminDashboard();
          }
        } else {
          switch (currentPage) {
            case 'dashboard': content = renderInternDashboard(); break;
            case 'my-tasks': content = renderMyTasksPage(); break;
            case 'my-projects': content = renderProjectsPage(); break;
            case 'my-team': content = renderTeamsPage(); break;
            case 'submit-ticket': content = renderSubmitTicketPage(); break;
            case 'intern-space': content = renderInternSpacePage(); break;
            default: content = renderInternDashboard();
          }
        }
        
        app.innerHTML = `
          <div class="h-full w-full flex relative">
            <div class="mobile-overlay" onclick="closeSidebar()"></div>
            ${renderSidebar()}
            <main class="flex-1 overflow-y-auto bg-slate-50 scrollbar-thin w-full">
              ${renderMobileHeader()}
              ${content}
            </main>
          </div>
          ${renderModals()}
        `;
        
        attachFormHandlers();
        
        // Scroll messages to bottom if on intern space
        if (currentPage === 'intern-space') {
          setTimeout(scrollMessagesToBottom, 100);
        }
      }
    }

    // Event Handlers
    function attachLoginHandler() {
      const form = document.getElementById('loginForm');
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('loginEmail').value.trim();
          const password = document.getElementById('loginPassword').value.trim();
          const errorEl = document.getElementById('loginError');
          
          if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
            currentUser = { id: 'admin', name: 'Admin', email: ADMIN_EMAIL, role: 'admin' };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            currentPage = 'dashboard';
            localStorage.setItem('currentPage', currentPage);
            render();
            return;
          }
          
          const intern = appData.interns.find(i => i.email === email && i.password === password);
          if (intern) {
            currentUser = { id: intern.id, name: intern.name, email: intern.email, role: intern.role, photoUrl: intern.photoUrl };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            currentPage = 'dashboard';
            localStorage.setItem('currentPage', currentPage);
            render();
            return;
          }
          
          errorEl.textContent = 'Invalid email or password';
          errorEl.classList.remove('hidden');
        });
      }
    }

    function attachFormHandlers() {
      // Add Intern
      const addInternForm = document.getElementById('addInternForm');
      if (addInternForm) {
        addInternForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('addInternBtn');
          btn.disabled = true;
          btn.textContent = 'Adding...';
          
          const intern = {
            type: 'intern',
            id: generateId(),
            name: document.getElementById('internName').value,
            email: document.getElementById('internEmail').value,
            password: document.getElementById('internPassword').value,
            role: document.getElementById('internRole').value,
            photoUrl: document.getElementById('internPhoto').value || '',
            status: 'active',
            isStarIntern: false
          };
          
          const result = await createFirestoreDoc(intern);
          if (result.success) {
            closeModal('addIntern');
          } else {
            btn.disabled = false;
            btn.textContent = 'Add Intern';
          }
        });
      }

      // Edit Intern
      const editInternForm = document.getElementById('editInternForm');
      if (editInternForm) {
        editInternForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('editInternBtn');
          btn.disabled = true;
          btn.textContent = 'Saving...';
          
          editingIntern.name = document.getElementById('editInternName').value;
          editingIntern.email = document.getElementById('editInternEmail').value;
          editingIntern.password = document.getElementById('editInternPassword').value;
          editingIntern.role = document.getElementById('editInternRole').value;
          editingIntern.photoUrl = document.getElementById('editInternPhoto').value || '';
          
          const result = await updateFirestoreDoc(editingIntern);
          if (result.success) {
            closeModal('editIntern');
          } else {
            btn.disabled = false;
            btn.textContent = 'Save Changes';
          }
        });
      }

      // Add Task
      const addTaskForm = document.getElementById('addTaskForm');
      if (addTaskForm) {
        addTaskForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('addTaskBtn');
          btn.disabled = true;
          btn.textContent = 'Creating...';
          
          const task = {
            type: 'task',
            id: generateId(),
            title: document.getElementById('taskTitle').value,
            description: document.getElementById('taskDescription').value,
            deadline: document.getElementById('taskDeadline').value,
            priority: document.getElementById('taskPriority').value,
            assignedTo: document.getElementById('taskAssign').value,
            taskStatus: 'open'
          };
          
          const result = await createFirestoreDoc(task);
          if (result.success) {
            closeModal('addTask');
          } else {
            btn.disabled = false;
            btn.textContent = 'Create';
          }
        });
      }

      // Add Project
      const addProjectForm = document.getElementById('addProjectForm');
      if (addProjectForm) {
        addProjectForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('addProjectBtn');
          btn.disabled = true;
          btn.textContent = 'Adding...';
          
          const project = {
            type: 'project',
            id: generateId(),
            projectTitle: document.getElementById('projectTitle').value,
            projectDescription: document.getElementById('projectDescription').value,
            technologies: document.getElementById('projectTech').value,
            projectStatus: document.getElementById('projectStatus').value,
            startDate: new Date().toISOString().split('T')[0]
          };
          
          const result = await createFirestoreDoc(project);
          if (result.success) {
            closeModal('addProject');
          } else {
            btn.disabled = false;
            btn.textContent = 'Add';
          }
        });
      }

      // Add Team
      const addTeamForm = document.getElementById('addTeamForm');
      if (addTeamForm) {
        addTeamForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('addTeamBtn');
          btn.disabled = true;
          btn.textContent = 'Creating...';
          
          const checkboxes = document.querySelectorAll('.team-member-checkbox:checked');
          const members = Array.from(checkboxes).map(cb => cb.value).join(',');
          
          const team = {
            type: 'team',
            id: generateId(),
            teamName: document.getElementById('teamName').value,
            teamDescription: document.getElementById('teamDescription').value,
            members: members
          };
          
          const result = await createFirestoreDoc(team);
          if (result.success) {
            closeModal('addTeam');
          } else {
            btn.disabled = false;
            btn.textContent = 'Create';
          }
        });
      }

      // Edit Team
      const editTeamForm = document.getElementById('editTeamForm');
      if (editTeamForm) {
        editTeamForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('editTeamBtn');
          btn.disabled = true;
          btn.textContent = 'Saving...';
          
          const checkboxes = document.querySelectorAll('.edit-team-member-checkbox:checked');
          const members = Array.from(checkboxes).map(cb => cb.value).join(',');
          
          editingIntern.teamName = document.getElementById('editTeamName').value;
          editingIntern.teamDescription = document.getElementById('editTeamDescription').value;
          editingIntern.members = members;
          
          const result = await updateFirestoreDoc(editingIntern);
          if (result.success) {
            closeModal('editTeam');
          } else {
            btn.disabled = false;
            btn.textContent = 'Save Changes';
          }
        });
      }



      // Submit Task
      const submitTaskForm = document.getElementById('submitTaskForm');
      if (submitTaskForm) {
        submitTaskForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('submitTaskBtn');
          btn.disabled = true;
          btn.textContent = 'Submitting...';
          
          const submission = {
            type: 'submission',
            id: generateId(),
            taskId: selectedInternId,
            submittedBy: currentUser.id,
            submittedByName: currentUser.name,
            submissionText: document.getElementById('submissionText').value,
            submissionUrl: document.getElementById('submissionUrl').value,
            submissionStatus: 'pending'
          };
          
          const result = await createFirestoreDoc(submission);
          if (result.success) {
            closeModal('submitTask');
          } else {
            btn.disabled = false;
            btn.textContent = 'Submit';
          }
        });
      }

      // Raise Ticket
      const raiseTicketForm = document.getElementById('raiseTicketForm');
      if (raiseTicketForm) {
        raiseTicketForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const btn = document.getElementById('raiseTicketBtn');
          btn.disabled = true;
          btn.textContent = 'Submitting...';
          
          const ticket = {
            type: 'ticket',
            id: generateId(),
            message: document.getElementById('ticketMessage').value,
            priority: document.getElementById('ticketPriority').value,
            raisedBy: currentUser.id,
            raisedByName: currentUser.name,
            ticketStatus: 'open'
          };
          
          const result = await createFirestoreDoc(ticket);
          if (result.success) {
            closeModal('raiseTicket');
          } else {
            btn.disabled = false;
            btn.textContent = 'Submit';
          }
        });
      }

      // Send Message
      const sendMessageForm = document.getElementById('sendMessageForm');
      if (sendMessageForm) {
        sendMessageForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const input = document.getElementById('messageInput');
          const btn = document.getElementById('sendMessageBtn');
          const messageText = input.value.trim();
          
          if (!messageText) return;
          
          btn.disabled = true;
          input.disabled = true;
          
          const message = {
            type: 'message',
            id: generateId(),
            message: messageText,
            senderId: currentUser.id,
            senderName: currentUser.name
          };
          
          const result = await createFirestoreDoc(message);
          if (result.success) {
            input.value = '';
          }
          
          btn.disabled = false;
          input.disabled = false;
          input.focus();
        });
      }

      // Send Team Message
      const sendTeamMessageForm = document.getElementById('sendTeamMessageForm');
      if (sendTeamMessageForm) {
        sendTeamMessageForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const input = document.getElementById('teamMessageInput');
          const btn = document.getElementById('sendTeamMessageBtn');
          const messageText = input.value.trim();
          
          if (!messageText || !selectedTeamId) return;
          
          btn.disabled = true;
          input.disabled = true;
          
          const message = {
            type: 'teamMessage',
            id: generateId(),
            teamId: selectedTeamId,
            message: messageText,
            senderId: currentUser.id,
            senderName: currentUser.name
          };
          
          const result = await createFirestoreDoc(message);
          if (result.success) {
            input.value = '';
            // Scroll to bottom after sending
            setTimeout(() => {
              const container = document.getElementById('teamMessagesContainer');
              if (container) {
                container.scrollTop = container.scrollHeight;
              }
            }, 100);
          }
          
          btn.disabled = false;
          input.disabled = false;
          input.focus();
        });
      }
    }

    // Star Intern Functions
    window.setStarIntern = async function(internId) {
      const currentStar = getStarIntern();
      if (currentStar) {
        currentStar.isStarIntern = false;
        await updateFirestoreDoc(currentStar);
      }
      
      const intern = appData.interns.find(i => i.id === internId);
      if (intern) {
        intern.isStarIntern = true;
        intern.weekStartDate = new Date().toISOString().split('T')[0];
        const result = await updateFirestoreDoc(intern);
        if (result.success) {
          triggerConfetti();
        }
      }
    };

    window.removeStarIntern = async function(internId) {
      const intern = appData.interns.find(i => i.id === internId);
      if (intern) {
        intern.isStarIntern = false;
        await updateFirestoreDoc(intern);
      }
    };

    // Edit Intern Functions
    window.openEditInternModal = function(internId) {
      editingIntern = appData.interns.find(i => i.id === internId);
      if (editingIntern) {
        modals.editIntern = true;
        render();
      }
    };

    // Edit Team Functions
    window.openEditTeamModal = function(teamId) {
      editingIntern = appData.teams.find(t => t.id === teamId);
      if (editingIntern) {
        modals.editTeam = true;
        render();
      }
    };

    // Delete Functions
    window.confirmDeleteIntern = function(internId) {
      confirmDelete = internId;
      render();
    };

    window.confirmDeleteTeam = function(teamId) {
      confirmDelete = 'team_' + teamId;
      render();
    };

    window.cancelDelete = function() {
      confirmDelete = null;
      render();
    };

    window.deleteIntern = async function(internId) {
      const intern = appData.interns.find(i => i.id === internId);
      if (intern) {
        const result = await deleteFirestoreDoc(intern);
        if (result.success) {
          confirmDelete = null;
          render();
        }
      }
    };

    window.deleteTeam = async function(teamId) {
      const team = appData.teams.find(t => t.id === teamId);
      if (team) {
        const result = await deleteFirestoreDoc(team);
        if (result.success) {
          confirmDelete = null;
          render();
        }
      }
    };

    // Resolve Ticket
    window.resolveTicket = async function(ticketId) {
      const ticket = appData.tickets.find(t => t.id === ticketId);
      if (ticket) {
        ticket.ticketStatus = 'resolved';
        await updateFirestoreDoc(ticket);
      }
    };

    // Modal Functions
    window.openModal = function(modal) {
      modals[modal] = true;
      render();
    };

    window.closeModal = function(modal) {
      modals[modal] = false;
      selectedInternId = null;
      selectedTeamId = null;
      editingIntern = null;
      currentCalendarDate = new Date();
      render();
    };

    window.openTeamModal = function(teamId) {
      selectedTeamId = teamId;
      modals.teamHub = true;
      render();
      setTimeout(() => {
        const container = document.getElementById('teamMessagesContainer');
        if (container) {
          container.scrollTop = container.scrollHeight;
        }
      }, 100);
    };

    window.openAttendanceModal = function(internId) {
      selectedInternId = internId;
      currentAttendanceInternId = internId;
      currentCalendarDate = new Date();
      modals.attendance = true;
      render();
    };

    // Calendar Functions
    window.changeCalendarMonth = function(direction) {
      currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
      render();
    };

    window.toggleAttendance = async function(dateStr) {
      if (!currentAttendanceInternId) return;
      
      const attendanceStats = getAttendanceStats(currentAttendanceInternId);
      const currentStatus = attendanceStats.byDate[dateStr] || '';
      
      // Optimistically update UI immediately without full re-render
      const dayElement = event.target.closest('[onclick*="toggleAttendance"]');
      if (dayElement) {
        dayElement.style.opacity = '0.5';
        dayElement.style.pointerEvents = 'none';
      }
      
      // Cycle through: none -> present -> wfh -> absent -> leave -> none
      let newStatus = '';
      if (currentStatus === '') {
        newStatus = 'present';
      } else if (currentStatus === 'present') {
        newStatus = 'wfh';
      } else if (currentStatus === 'wfh') {
        newStatus = 'absent';
      } else if (currentStatus === 'absent') {
        newStatus = 'leave';
      } else {
        newStatus = '';
      }
      
      // Find existing record for this date
      const existingRecord = appData.attendance.find(
        a => a.internId === currentAttendanceInternId && a.date === dateStr
      );
      
      if (newStatus === '') {
        // Delete the record
        if (existingRecord) {
          await deleteFirestoreDoc(existingRecord);
        }
      } else if (existingRecord) {
        // Update existing record
        existingRecord.status = newStatus;
        await updateFirestoreDoc(existingRecord);
      } else {
        // Create new record
        const intern = appData.interns.find(i => i.id === currentAttendanceInternId);
        const attendance = {
          type: 'attendance',
          id: generateId(),
          internId: currentAttendanceInternId,
          internName: intern ? intern.name : '',
          date: dateStr,
          status: newStatus
        };
        await createFirestoreDoc(attendance);
      }
      
      // Re-enable the element
      if (dayElement) {
        dayElement.style.opacity = '1';
        dayElement.style.pointerEvents = 'auto';
      }
    };

    window.openSubmitTaskModal = function(taskId) {
      selectedInternId = taskId;
      modals.submitTask = true;
      render();
    };

    // Navigation
    window.navigateTo = function(page) {
      currentPage = page;
      localStorage.setItem('currentPage', page);
      closeSidebar();
      render();
    };

    // Team Hub Functions
    window.openTeamModal = function(teamId) {
      selectedTeamId = teamId;
      modals.teamHub = true;
      render();
      setTimeout(() => {
        const container = document.getElementById('teamMessagesContainer');
        if (container) {
          container.scrollTop = container.scrollHeight;
        }
      }, 100);
    };

    window.switchTeamTab = function(tabName) {
      // Hide all content
      document.querySelectorAll('.team-content').forEach(el => el.classList.add('hidden'));
      // Show selected content
      const content = document.getElementById(`teamContent-${tabName}`);
      if (content) content.classList.remove('hidden');
      
      // Update tab styles
      document.querySelectorAll('.team-tab').forEach(tab => {
        tab.classList.remove('border-blue-600', 'text-blue-600');
        tab.classList.add('border-transparent', 'text-slate-600');
      });
      const activeTab = document.getElementById(`teamTab-${tabName}`);
      if (activeTab) {
        activeTab.classList.add('border-blue-600', 'text-blue-600');
        activeTab.classList.remove('border-transparent', 'text-slate-600');
      }
      
      // Scroll team messages to bottom when switching to chat tab
      if (tabName === 'chat') {
        setTimeout(() => {
          const container = document.getElementById('teamMessagesContainer');
          if (container) {
            container.scrollTop = container.scrollHeight;
          }
        }, 100);
      }
    };

    window.openScheduleMeetingModal = function(teamId) {
      // Placeholder for now
      alert('Meeting scheduling coming soon!');
    };

    window.openCreateTeamTaskModal = function(teamId) {
      // Placeholder for now
      alert('Team task creation coming soon!');
    };

    window.openAddResourceModal = function(teamId) {
      // Placeholder for now
      alert('Resource upload coming soon!');
    };

    // Sidebar toggle
    window.toggleSidebar = toggleSidebar;
    window.closeSidebar = closeSidebar;

    // Logout
    window.logout = function() {
      if (unsubscribeFirestore) {
        unsubscribeFirestore();
      }
      currentUser = null;
      currentPage = 'dashboard';
      localStorage.removeItem('currentUser');
      localStorage.removeItem('currentPage');
      render();
    };

    // Toggle dark mode
    window.toggleDarkMode = toggleDarkMode;

    // Initialize
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bcba77f67f1d9c7',t:'MTc2ODIxMDQyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
